var at=Object.defineProperty;var U=(e,t)=>{for(var n in t)at(e,n,{get:t[n],enumerable:!0})};function ce(e){let t=atob(e),n=t.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=t.charCodeAt(r);return i}function V(e){typeof e=="string"&&(e=new TextEncoder().encode(e));let t="",n=e.byteLength;for(let i=0;i<n;i++)t+=String.fromCharCode(e[i]);return btoa(t)}var A=e=>{throw new Error("Not initialized yet")},X=typeof window>"u"&&typeof globalThis.WebSocketPair>"u";typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var J=new Map,j=0;X&&(globalThis.syscall=async(e,...t)=>await new Promise((n,i)=>{j++,J.set(j,{resolve:n,reject:i}),A({type:"sys",id:j,name:e,args:t})}));function ue(e,t,n){X&&(A=n,self.addEventListener("message",i=>{(async()=>{let r=i.data;switch(r.type){case"inv":{let o=e[r.name];if(!o)throw new Error(`Function not loaded: ${r.name}`);try{let a=await Promise.resolve(o(...r.args||[]));A({type:"invr",id:r.id,result:a})}catch(a){console.error("An exception was thrown as a result of invoking function",r.name,"error:",a.message),A({type:"invr",id:r.id,error:a.message})}}break;case"sysr":{let o=r.id,a=J.get(o);if(!a)throw Error("Invalid request id");J.delete(o),r.error?a.reject(new Error(r.error)):a.resolve(r.result)}break}})().catch(console.error)}),A({type:"manifest",manifest:t}))}async function lt(e,t){if(typeof e!="string"){let n=new Uint8Array(await e.arrayBuffer()),i=n.length>0?V(n):void 0;t={method:e.method,headers:Object.fromEntries(e.headers.entries()),base64Body:i},e=e.url}return syscall("sandboxFetch.fetch",e,t)}globalThis.nativeFetch=globalThis.fetch;function ct(){globalThis.fetch=async function(e,t){let n=t&&t.body?V(new Uint8Array(await new Response(t.body).arrayBuffer())):void 0,i=await lt(e,t&&{method:t.method,headers:t.headers,base64Body:n});return new Response(i.base64Body?ce(i.base64Body):null,{status:i.status,headers:i.headers})}}X&&ct();var B={};U(B,{alert:()=>Qt,configureVimMode:()=>un,confirm:()=>Gt,copyToClipboard:()=>on,deleteLine:()=>sn,dispatch:()=>Yt,downloadFile:()=>Rt,filterBox:()=>Ot,flashNotification:()=>Nt,fold:()=>Jt,foldAll:()=>Zt,getCurrentEditor:()=>dt,getCurrentPage:()=>ut,getCurrentPageMeta:()=>pt,getCurrentPath:()=>ft,getCursor:()=>yt,getRecentlyOpenedPages:()=>ht,getSelection:()=>xt,getText:()=>mt,getUiOption:()=>Vt,goHistory:()=>_t,hidePanel:()=>Dt,insertAtCursor:()=>qt,insertAtPos:()=>Bt,invokeCommand:()=>St,moveCursor:()=>Kt,moveCursorToLine:()=>Wt,moveLineDown:()=>ln,moveLineUp:()=>an,navigate:()=>Tt,newWindow:()=>Lt,openCommandPalette:()=>Pt,openPageNavigator:()=>kt,openSearchPanel:()=>rn,openUrl:()=>Mt,prompt:()=>Ht,rebuildEditorState:()=>Ct,redo:()=>nn,reloadConfigAndCommands:()=>vt,reloadPage:()=>Et,reloadUI:()=>At,replaceRange:()=>$t,save:()=>wt,sendMessage:()=>pn,setSelection:()=>bt,setText:()=>gt,setUiOption:()=>jt,showPanel:()=>Ft,showProgress:()=>Ut,toggleFold:()=>zt,undo:()=>tn,unfold:()=>Xt,unfoldAll:()=>en,uploadFile:()=>It,vimEx:()=>cn});typeof self>"u"&&(self={syscall:()=>{throw new Error("Not implemented here")}});function s(e,...t){return globalThis.syscall(e,...t)}function ut(){return s("editor.getCurrentPage")}function pt(){return s("editor.getCurrentPageMeta")}function ft(e=!1){return s("editor.getCurrentPath",e)}function ht(){return s("editor.getRecentlyOpenedPages")}function dt(){return s("editor.getCurrentEditor")}function mt(){return s("editor.getText")}function gt(e,t=!1){return s("editor.setText",e,t)}function yt(){return s("editor.getCursor")}function xt(){return s("editor.getSelection")}function bt(e,t){return s("editor.setSelection",e,t)}function St(e,t){return s("editor.invokeCommand",e,t)}function wt(){return s("editor.save")}function Tt(e,t=!1,n=!1){return s("editor.navigate",e,t,n)}function kt(e="page"){return s("editor.openPageNavigator",e)}function Pt(){return s("editor.openCommandPalette")}function Et(){return s("editor.reloadPage")}function At(){return s("editor.reloadUI")}function Ct(){return s("editor.rebuildEditorState")}function vt(){return s("editor.reloadConfigAndCommands")}function Mt(e,t=!1){return s("editor.openUrl",e,t)}function Lt(){return s("editor.newWindow")}function _t(e){return s("editor.goHistory",e)}function Rt(e,t){return s("editor.downloadFile",e,t)}function It(e,t){return s("editor.uploadFile",e,t)}function Nt(e,t="info"){return s("editor.flashNotification",e,t)}function Ot(e,t,n="",i=""){return s("editor.filterBox",e,t,n,i)}function Ft(e,t,n,i=""){return s("editor.showPanel",e,t,n,i)}function Dt(e){return s("editor.hidePanel",e)}function Ut(e,t){return s("editor.showProgress",e,t)}function Bt(e,t){return s("editor.insertAtPos",e,t)}function $t(e,t,n){return s("editor.replaceRange",e,t,n)}function Kt(e,t=!1){return s("editor.moveCursor",e,t)}function Wt(e,t=1,n=!1){return s("editor.moveCursorToLine",e,t,n)}function qt(e,t=!1,n=!1){return s("editor.insertAtCursor",e,t,n)}function Yt(e){return s("editor.dispatch",e)}function Ht(e,t=""){return s("editor.prompt",e,t)}function Gt(e){return s("editor.confirm",e)}function Qt(e){return s("editor.alert",e)}function Vt(e){return s("editor.getUiOption",e)}function jt(e,t){return s("editor.setUiOption",e,t)}function Jt(){return s("editor.fold")}function Xt(){return s("editor.unfold")}function zt(){return s("editor.toggleFold")}function Zt(){return s("editor.foldAll")}function en(){return s("editor.unfoldAll")}function tn(){return s("editor.undo")}function nn(){return s("editor.redo")}function rn(){return s("editor.openSearchPanel")}function on(e){return s("editor.copyToClipboard",e)}function sn(){return s("editor.deleteLine")}function an(){return s("editor.moveLineUp")}function ln(){return s("editor.moveLineDown")}function cn(e){return s("editor.vimEx",e)}function un(){return s("editor.configureVimMode")}function pn(e,t){return s("editor.sendMessage",e,t)}var C={};U(C,{deleteDocument:()=>Pn,deleteFile:()=>Mn,deletePage:()=>xn,fileExists:()=>Ln,getDocumentMeta:()=>wn,getFileMeta:()=>Cn,getPageMeta:()=>dn,listDocuments:()=>Sn,listFiles:()=>En,listPages:()=>hn,listPlugs:()=>bn,pageExists:()=>mn,readDocument:()=>Tn,readFile:()=>An,readPage:()=>gn,writeDocument:()=>kn,writeFile:()=>vn,writePage:()=>yn});function hn(){return s("space.listPages")}function dn(e){return s("space.getPageMeta",e)}function mn(e){return s("space.pageExists",e)}function gn(e){return s("space.readPage",e)}function yn(e,t){return s("space.writePage",e,t)}function xn(e){return s("space.deletePage",e)}function bn(){return s("space.listPlugs")}function Sn(){return s("space.listDocuments")}function wn(e){return s("space.getDocumentMeta",e)}function Tn(e){return s("space.readDocument",e)}function kn(e,t){return s("space.writeDocument",e,t)}function Pn(e){return s("space.deleteDocument",e)}function En(){return s("space.listFiles")}function An(e){return s("space.readFile",e)}function Cn(e){return s("space.getFileMeta",e)}function vn(e,t){return s("space.writeFile",e,t)}function Mn(e){return s("space.deleteFile",e)}function Ln(e){return s("space.fileExists",e)}var $={};U($,{getConfig:()=>Un,getMode:()=>Fn,getVersion:()=>Dn,invokeCommand:()=>Rn,invokeFunction:()=>_n,listCommands:()=>In,listSyscalls:()=>Nn,reloadPlugs:()=>On,wipeClient:()=>Bn});function _n(e,...t){return s("system.invokeFunction",e,...t)}function Rn(e,t){return s("system.invokeCommand",e,t)}function In(){return s("system.listCommands")}function Nn(){return s("system.listSyscalls")}function On(){return s("system.reloadPlugs")}function Fn(){return s("system.getMode")}function Dn(){return s("system.getVersion")}function Un(e,t=void 0){return s("system.getConfig",e,t)}function Bn(e=!1){return s("system.wipeClient",e)}var K={};U(K,{refreshAll:()=>qn});function qn(){return s("codeWidget.refreshAll")}function x(e){return e===10||e===13}function T(e){return e===9||e===32}function g(e){return T(e)||x(e)}function k(e){return e===44||e===91||e===93||e===123||e===125}var z=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Zn(e){if(e===null)return!1;let t,n=0,i=e.length,r=z;for(let o=0;o<i;o++)if(t=r.indexOf(e.charAt(o)),!(t>64)){if(t<0)return!1;n+=6}return n%8===0}function er(e){let t=e.replace(/[\r\n=]/g,""),n=t.length,i=z,r=[],o=0;for(let c=0;c<n;c++)c%4===0&&c&&(r.push(o>>16&255),r.push(o>>8&255),r.push(o&255)),o=o<<6|i.indexOf(t.charAt(c));let a=n%4*6;return a===0?(r.push(o>>16&255),r.push(o>>8&255),r.push(o&255)):a===18?(r.push(o>>10&255),r.push(o>>2&255)):a===12&&r.push(o>>4&255),new Uint8Array(r)}function tr(e){let t=e.length,n=z,i="",r=0;for(let a=0;a<t;a++)a%3===0&&a&&(i+=n[r>>18&63],i+=n[r>>12&63],i+=n[r>>6&63],i+=n[r&63]),r=(r<<8)+e[a];let o=t%3;return o===0?(i+=n[r>>18&63],i+=n[r>>12&63],i+=n[r>>6&63],i+=n[r&63]):o===2?(i+=n[r>>10&63],i+=n[r>>4&63],i+=n[r<<2&63],i+=n[64]):o===1&&(i+=n[r>>2&63],i+=n[r<<4&63],i+=n[64],i+=n[64]),i}function nr(e){return e instanceof Uint8Array}var pe={tag:"tag:yaml.org,2002:binary",construct:er,kind:"scalar",predicate:nr,represent:tr,resolve:Zn};var fe=["true","True","TRUE"],rr=["false","False","FALSE"],ir=[...fe,...rr],he={tag:"tag:yaml.org,2002:bool",kind:"scalar",defaultStyle:"lowercase",predicate:e=>typeof e=="boolean"||e instanceof Boolean,construct:e=>fe.includes(e),resolve:e=>ir.includes(e),represent:{lowercase:e=>(e instanceof Boolean?e.valueOf():e)?"true":"false",uppercase:e=>(e instanceof Boolean?e.valueOf():e)?"TRUE":"FALSE",camelcase:e=>(e instanceof Boolean?e.valueOf():e)?"True":"False"}};function Z(e){return e!==null&&typeof e=="object"}function v(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}function P(e){return Object.prototype.toString.call(e)==="[object Object]"}var or=new RegExp("^(?:[-+]?(?:0|[1-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function sr(e){return!(!or.test(e)||e[e.length-1]==="_")}function ar(e){let t=e.replace(/_/g,"").toLowerCase(),n=t[0]==="-"?-1:1;return t[0]&&"+-".includes(t[0])&&(t=t.slice(1)),t===".inf"?n===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t===".nan"?NaN:n*parseFloat(t)}var lr=/^[-+]?[0-9]+e/;function cr(e,t){let n=e instanceof Number?e.valueOf():e;if(isNaN(n))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===n)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===n)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(v(n))return"-0.0";let i=n.toString(10);return lr.test(i)?i.replace("e",".e"):i}function ur(e){return e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&(e%1!==0||v(e))}var de={tag:"tag:yaml.org,2002:float",construct:ar,defaultStyle:"lowercase",kind:"scalar",predicate:ur,represent:cr,resolve:sr};function M(e,t,n){return t<=e&&e<=n}function pr(e){return M(e,48,57)||M(e,65,70)||M(e,97,102)}function fr(e){return M(e,48,55)}function hr(e){return M(e,48,57)}function dr(e){let t=e.length,n=0,i=!1;if(!t)return!1;let r=e[n];if((r==="-"||r==="+")&&(r=e[++n]),r==="0"){if(n+1===t)return!0;if(r=e[++n],r==="b"){for(n++;n<t;n++)if(r=e[n],r!=="_"){if(r!=="0"&&r!=="1")return!1;i=!0}return i&&r!=="_"}if(r==="x"){for(n++;n<t;n++)if(r=e[n],r!=="_"){if(!pr(e.charCodeAt(n)))return!1;i=!0}return i&&r!=="_"}for(;n<t;n++)if(r=e[n],r!=="_"){if(!fr(e.charCodeAt(n)))return!1;i=!0}return i&&r!=="_"}if(r==="_")return!1;for(;n<t;n++)if(r=e[n],r!=="_"){if(!hr(e.charCodeAt(n)))return!1;i=!0}return!i||r==="_"?!1:/^(:[0-5]?[0-9])+$/.test(e.slice(n))}function mr(e){let t=e;t.includes("_")&&(t=t.replace(/_/g,""));let n=1,i=t[0];return(i==="-"||i==="+")&&(i==="-"&&(n=-1),t=t.slice(1),i=t[0]),t==="0"?0:i==="0"?t[1]==="b"?n*parseInt(t.slice(2),2):t[1]==="x"?n*parseInt(t,16):n*parseInt(t,8):n*parseInt(t,10)}function gr(e){return e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&e%1===0&&!v(e)}var me={tag:"tag:yaml.org,2002:int",construct:mr,defaultStyle:"decimal",kind:"scalar",predicate:gr,represent:{binary(e){let t=e instanceof Number?e.valueOf():e;return t>=0?`0b${t.toString(2)}`:`-0b${t.toString(2).slice(1)}`},octal(e){let t=e instanceof Number?e.valueOf():e;return t>=0?`0${t.toString(8)}`:`-0${t.toString(8).slice(1)}`},decimal(e){return(e instanceof Number?e.valueOf():e).toString(10)},hexadecimal(e){let t=e instanceof Number?e.valueOf():e;return t>=0?`0x${t.toString(16).toUpperCase()}`:`-0x${t.toString(16).toUpperCase().slice(1)}`}},resolve:dr};var ge={tag:"tag:yaml.org,2002:map",resolve(){return!0},construct(e){return e!==null?e:{}},kind:"mapping"};var ye={tag:"tag:yaml.org,2002:merge",kind:"scalar",resolve:e=>e==="<<"||e===null,construct:e=>e};var xe={tag:"tag:yaml.org,2002:null",kind:"scalar",defaultStyle:"lowercase",predicate:e=>e===null,construct:()=>null,resolve:e=>e==="~"||e==="null"||e==="Null"||e==="NULL",represent:{lowercase:()=>"null",uppercase:()=>"NULL",camelcase:()=>"Null"}};function yr(e){let t=new Set;for(let n of e){if(!P(n))return!1;let i=Object.keys(n);if(i.length!==1)return!1;for(let r of i){if(t.has(r))return!1;t.add(r)}}return!0}var be={tag:"tag:yaml.org,2002:omap",kind:"sequence",resolve:yr,construct(e){return e}};function xr(e){return e===null?!0:e.every(t=>P(t)&&Object.keys(t).length===1)}var Se={tag:"tag:yaml.org,2002:pairs",construct(e){return e?.flatMap(Object.entries)??[]},kind:"sequence",resolve:xr};var we=/^\/(?<regexp>[\s\S]+)\/(?<modifiers>[gismuy]*)$/,Te={tag:"tag:yaml.org,2002:js/regexp",kind:"scalar",resolve(e){if(e===null||!e.length)return!1;if(e.charAt(0)==="/"){let t=e.match(we)?.groups;if(!t)return!1;let n=t.modifiers??"";if(new Set(n).size<n.length)return!1}return!0},construct(e){let{regexp:t=e,modifiers:n=""}=e.match(we)?.groups??{};return new RegExp(t,n)},predicate:e=>e instanceof RegExp,represent:e=>e.toString()};var ke={tag:"tag:yaml.org,2002:seq",kind:"sequence",resolve:()=>!0,construct:e=>e!==null?e:[]};var Pe={tag:"tag:yaml.org,2002:set",kind:"mapping",construct:e=>e!==null?e:{},resolve:e=>e===null?!0:Object.values(e).every(t=>t===null)};var Ee={tag:"tag:yaml.org,2002:str",kind:"scalar",resolve:()=>!0,construct:e=>e!==null?e:""};var Ae=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Ce=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function br(e){return e===null?!1:Ae.exec(e)!==null||Ce.exec(e)!==null}function Sr(e){let t=Ae.exec(e);if(t===null&&(t=Ce.exec(e)),t===null)throw new Error("Cannot construct YAML timestamp: date resolve error");let n=+t[1],i=+t[2]-1,r=+t[3];if(!t[4])return new Date(Date.UTC(n,i,r));let o=+t[4],a=+t[5],c=+t[6],l=0;if(t[7]){let p=t[7].slice(0,3);for(;p.length<3;)p+="0";l=+p}let f=null;if(t[9]&&t[10]){let p=+t[10],d=+(t[11]||0);f=(p*60+d)*6e4,t[9]==="-"&&(f=-f)}let u=new Date(Date.UTC(n,i,r,o,a,c,l));return f&&u.setTime(u.getTime()-f),u}function wr(e){return e.toISOString()}var ve={tag:"tag:yaml.org,2002:timestamp",construct:Sr,predicate(e){return e instanceof Date},kind:"scalar",represent:wr,resolve:br};var Me={tag:"tag:yaml.org,2002:js/undefined",kind:"scalar",resolve(){return!0},construct(){},predicate(e){return typeof e>"u"},represent(){return""}};function Tr(e,t){let n={fallback:new Map,mapping:new Map,scalar:new Map,sequence:new Map},i=n.fallback;for(let r of[...e,...t])n[r.kind].set(r.tag,r),i.set(r.tag,r);return n}function L({explicitTypes:e=[],implicitTypes:t=[],include:n}){n&&(t.push(...n.implicitTypes),e.push(...n.explicitTypes));let i=Tr(t,e);return{implicitTypes:t,explicitTypes:e,typeMap:i}}var Le=L({explicitTypes:[Ee,ke,ge]}),_e=L({implicitTypes:[xe,he,me,de],include:Le}),Re=L({include:_e}),_=L({explicitTypes:[pe,be,Se,Pe],implicitTypes:[ve,ye],include:Re}),kr=L({explicitTypes:[Te,Me],include:_}),ee=new Map([["core",Re],["default",_],["failsafe",Le],["json",_e],["extended",kr]]);var W=1,Fe=2,De=3,q=4,te=1,Cr=2,Ue=3,vr=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Mr=/[\x85\u2028\u2029]/,Lr=/[,\[\]\{\}]/,Be=/^(?:!|!!|![a-z\-]+!)$/i,$e=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i,_r=new Map([[120,2],[117,4],[85,8]]),Ke=new Map([[48,"\0"],[97,"\x07"],[98,"\b"],[116,"	"],[9,"	"],[110,`
`],[118,"\v"],[102,"\f"],[114,"\r"],[101,"\x1B"],[32," "],[34,'"'],[47,"/"],[92,"\\"],[78,"\x85"],[95,"\xA0"],[76,"\u2028"],[80,"\u2029"]]);function Rr(e){if(48<=e&&e<=57)return e-48;let t=e|32;return 97<=t&&t<=102?t-97+10:-1}function Ir(e){return 48<=e&&e<=57?e-48:-1}function Nr(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var We=4,qe=75,Ye=`\0\r
\x85\u2028\u2029`;function Or(e,t){if(!e)return null;let n=t,i=t,r="",o="";for(;n>0&&!Ye.includes(e.charAt(n-1));)if(n--,t-n>qe/2-1){r=" ... ",n+=5;break}for(;i<e.length&&!Ye.includes(e.charAt(i));)if(i++,i-t>qe/2-1){o=" ... ",i-=5;break}let a=e.slice(n,i),c=" ".repeat(We),l=" ".repeat(We+t-n+r.length);return`${c+r+a+o}
${l}^`}function Fr(e,t,n,i){let r=`at line ${n+1}, column ${i+1}`,o=Or(e,t);return o&&(r+=`:
${o}`),r}var Q=class{input;length;lineIndent=0;lineStart=0;position=0;line=0;onWarning;allowDuplicateKeys;implicitTypes;typeMap;version;checkLineBreaks=!1;tagMap=new Map;anchorMap=new Map;tag;anchor;kind;result="";constructor(t,{schema:n=_,onWarning:i,allowDuplicateKeys:r=!1}){this.input=t,this.onWarning=i,this.allowDuplicateKeys=r,this.implicitTypes=n.implicitTypes,this.typeMap=n.typeMap,this.length=t.length,this.version=null,this.readIndent()}skipWhitespaces(){let t=this.peek();for(;T(t);)t=this.next()}skipComment(){let t=this.peek();if(t===35)for(t=this.next();t!==0&&!x(t);)t=this.next()}readIndent(){let t=this.peek();for(;t===32;)this.lineIndent+=1,t=this.next()}peek(t=0){return this.input.charCodeAt(this.position+t)}next(){return this.position+=1,this.peek()}#e(t){let n=Fr(this.input,this.position,this.line,this.position-this.lineStart);return new SyntaxError(`${t} ${n}`)}dispatchWarning(t){let n=this.#e(t);this.onWarning?.(n)}yamlDirectiveHandler(...t){if(this.version!==null)throw this.#e("Cannot handle YAML directive: duplication of %YAML directive");if(t.length!==1)throw this.#e("Cannot handle YAML directive: YAML directive accepts exactly one argument");let n=/^([0-9]+)\.([0-9]+)$/.exec(t[0]);if(n===null)throw this.#e("Cannot handle YAML directive: ill-formed argument");let i=parseInt(n[1],10),r=parseInt(n[2],10);if(i!==1)throw this.#e("Cannot handle YAML directive: unacceptable YAML version");if(this.version=t[0]??null,this.checkLineBreaks=r<2,r!==1&&r!==2)return this.dispatchWarning("Cannot handle YAML directive: unsupported YAML version")}tagDirectiveHandler(...t){if(t.length!==2)throw this.#e(`Cannot handle tag directive: directive accepts exactly two arguments, received ${t.length}`);let n=t[0],i=t[1];if(!Be.test(n))throw this.#e(`Cannot handle tag directive: ill-formed handle (first argument) in "${n}"`);if(this.tagMap.has(n))throw this.#e(`Cannot handle tag directive: previously declared suffix for "${n}" tag handle`);if(!$e.test(i))throw this.#e("Cannot handle tag directive: ill-formed tag prefix (second argument) of the TAG directive");this.tagMap.set(n,i)}captureSegment(t,n,i){if(t<n){let r=this.input.slice(t,n);if(i)for(let o=0;o<r.length;o++){let a=r.charCodeAt(o);if(!(a===9||32<=a&&a<=1114111))throw this.#e(`Expected valid JSON character: received "${a}"`)}else if(vr.test(r))throw this.#e("Stream contains non-printable characters");this.result+=r}}readBlockSequence(t){let n=!1,i=this.tag,r=this.anchor,o=[];this.anchor!==null&&typeof this.anchor<"u"&&this.anchorMap.set(this.anchor,o);let a=this.peek();for(;a!==0&&a===45;){let c=this.peek(1);if(!g(c))break;if(n=!0,this.position++,this.skipSeparationSpace(!0,-1)&&this.lineIndent<=t){o.push(null),a=this.peek();continue}let l=this.line;if(this.composeNode({parentIndent:t,nodeContext:De,allowToSeek:!1,allowCompact:!0}),o.push(this.result),this.skipSeparationSpace(!0,-1),a=this.peek(),(this.line===l||this.lineIndent>t)&&a!==0)throw this.#e("Cannot read block sequence: bad indentation of a sequence entry");if(this.lineIndent<t)break}return n?(this.tag=i,this.anchor=r,this.kind="sequence",this.result=o,!0):!1}mergeMappings(t,n,i){if(!Z(n))throw this.#e("Cannot merge mappings: the provided source object is unacceptable");for(let[r,o]of Object.entries(n))Object.hasOwn(t,r)||(Object.defineProperty(t,r,{value:o,writable:!0,enumerable:!0,configurable:!0}),i.add(r))}storeMappingPair(t,n,i,r,o,a,c){if(Array.isArray(r)){r=Array.prototype.slice.call(r);for(let l=0;l<r.length;l++){if(Array.isArray(r[l]))throw this.#e("Cannot store mapping pair: nested arrays are not supported inside keys");typeof r=="object"&&P(r[l])&&(r[l]="[object Object]")}}if(typeof r=="object"&&P(r)&&(r="[object Object]"),r=String(r),i==="tag:yaml.org,2002:merge")if(Array.isArray(o))for(let l=0;l<o.length;l++)this.mergeMappings(t,o[l],n);else this.mergeMappings(t,o,n);else{if(!this.allowDuplicateKeys&&!n.has(r)&&Object.hasOwn(t,r))throw this.line=a||this.line,this.position=c||this.position,this.#e("Cannot store mapping pair: duplicated key");Object.defineProperty(t,r,{value:o,writable:!0,enumerable:!0,configurable:!0}),n.delete(r)}return t}readLineBreak(){let t=this.peek();if(t===10)this.position++;else if(t===13)this.position++,this.peek()===10&&this.position++;else throw this.#e("Cannot read line: line break not found");this.line+=1,this.lineStart=this.position}skipSeparationSpace(t,n){let i=0,r=this.peek();for(;r!==0&&(this.skipWhitespaces(),r=this.peek(),t&&(this.skipComment(),r=this.peek()),x(r));)this.readLineBreak(),r=this.peek(),i++,this.lineIndent=0,this.readIndent(),r=this.peek();return n!==-1&&i!==0&&this.lineIndent<n&&this.dispatchWarning("deficient indentation"),i}testDocumentSeparator(){let t=this.peek();return!!((t===45||t===46)&&t===this.peek(1)&&t===this.peek(2)&&(t=this.peek(3),t===0||g(t)))}writeFoldedLines(t){t===1?this.result+=" ":t>1&&(this.result+=`
`.repeat(t-1))}readPlainScalar(t,n){let i=this.kind,r=this.result,o=this.peek();if(g(o)||k(o)||o===35||o===38||o===42||o===33||o===124||o===62||o===39||o===34||o===37||o===64||o===96)return!1;let a;if((o===63||o===45)&&(a=this.peek(1),g(a)||n&&k(a)))return!1;this.kind="scalar",this.result="";let c=this.position,l=this.position,f=!1,u=0;for(;o!==0;){if(o===58){if(a=this.peek(1),g(a)||n&&k(a))break}else if(o===35){let p=this.peek(-1);if(g(p))break}else{if(this.position===this.lineStart&&this.testDocumentSeparator()||n&&k(o))break;if(x(o)){u=this.line;let p=this.lineStart,d=this.lineIndent;if(this.skipSeparationSpace(!1,-1),this.lineIndent>=t){f=!0,o=this.peek();continue}else{this.position=c,this.line=u,this.lineStart=p,this.lineIndent=d;break}}}f&&(this.captureSegment(l,c,!1),this.writeFoldedLines(this.line-u),l=c=this.position,f=!1),T(o)||(c=this.position+1),o=this.next()}return this.captureSegment(l,c,!1),this.result?!0:(this.kind=i,this.result=r,!1)}readSingleQuotedScalar(t){let n=this.peek();if(n!==39)return!1;this.kind="scalar",this.result="",this.position++;let i=this.position,r=this.position;for(n=this.peek();n!==0;){if(n===39)if(this.captureSegment(i,this.position,!0),n=this.next(),n===39)i=this.position,this.position++,r=this.position;else return!0;else if(x(n))this.captureSegment(i,r,!0),this.writeFoldedLines(this.skipSeparationSpace(!1,t)),i=r=this.position;else{if(this.position===this.lineStart&&this.testDocumentSeparator())throw this.#e("Unexpected end of the document within a single quoted scalar");this.position++,r=this.position}n=this.peek()}throw this.#e("Unexpected end of the stream within a single quoted scalar")}readDoubleQuotedScalar(t){let n=this.peek();if(n!==34)return!1;this.kind="scalar",this.result="",this.position++;let i=this.position,r=this.position,o;for(n=this.peek();n!==0;){if(n===34)return this.captureSegment(r,this.position,!0),this.position++,!0;if(n===92){if(this.captureSegment(r,this.position,!0),n=this.next(),x(n))this.skipSeparationSpace(!1,t);else if(n<256&&Ke.has(n))this.result+=Ke.get(n),this.position++;else if((o=_r.get(n)??0)>0){let a=o,c=0;for(;a>0;a--)if(n=this.next(),(o=Rr(n))>=0)c=(c<<4)+o;else throw this.#e("Cannot read double quoted scalar: expected hexadecimal character");this.result+=Nr(c),this.position++}else throw this.#e("Cannot read double quoted scalar: unknown escape sequence");r=i=this.position}else if(x(n))this.captureSegment(r,i,!0),this.writeFoldedLines(this.skipSeparationSpace(!1,t)),r=i=this.position;else{if(this.position===this.lineStart&&this.testDocumentSeparator())throw this.#e("Unexpected end of the document within a double quoted scalar");this.position++,i=this.position}n=this.peek()}throw this.#e("Unexpected end of the stream within a double quoted scalar")}readFlowCollection(t){let n=this.peek(),i,r=!0,o={};if(n===91)i=93,r=!1,o=[];else if(n===123)i=125;else return!1;this.anchor!==null&&typeof this.anchor<"u"&&this.anchorMap.set(this.anchor,o),n=this.next();let a=this.tag,c=this.anchor,l=!0,f=null,u=null,p=null,d=!1,h=!1,y=0,m=0,E=new Set;for(;n!==0;){if(this.skipSeparationSpace(!0,t),n=this.peek(),n===i)return this.position++,this.tag=a,this.anchor=c,this.kind=r?"mapping":"sequence",this.result=o,!0;if(!l)throw this.#e("Cannot read flow collection: missing comma between flow collection entries");p=u=f=null,h=d=!1,n===63&&(y=this.peek(1),g(y)&&(h=d=!0,this.position++,this.skipSeparationSpace(!0,t))),m=this.line,this.composeNode({parentIndent:t,nodeContext:W,allowToSeek:!1,allowCompact:!0}),p=this.tag||null,u=this.result,this.skipSeparationSpace(!0,t),n=this.peek(),(d||this.line===m)&&n===58&&(h=!0,n=this.next(),this.skipSeparationSpace(!0,t),this.composeNode({parentIndent:t,nodeContext:W,allowToSeek:!1,allowCompact:!0}),f=this.result),r?this.storeMappingPair(o,E,p,u,f):h?o.push(this.storeMappingPair({},E,p,u,f)):o.push(u),this.skipSeparationSpace(!0,t),n=this.peek(),n===44?(l=!0,n=this.next()):l=!1}throw this.#e("Cannot read flow collection: unexpected end of the stream within a flow collection")}readBlockScalar(t){let n=te,i=!1,r=!1,o=t,a=0,c=!1,l=this.peek(),f=!1;if(l===124)f=!1;else if(l===62)f=!0;else return!1;this.kind="scalar",this.result="";let u=0;for(;l!==0;)if(l=this.next(),l===43||l===45)if(te===n)n=l===43?Ue:Cr;else throw this.#e("Cannot read block: chomping mode identifier repeated");else if((u=Ir(l))>=0){if(u===0)throw this.#e("Cannot read block: indentation width must be greater than 0");if(!r)o=t+u-1,r=!0;else throw this.#e("Cannot read block: indentation width identifier repeated")}else break;for(T(l)&&(this.skipWhitespaces(),this.skipComment(),l=this.peek());l!==0;){for(this.readLineBreak(),this.lineIndent=0,l=this.peek();(!r||this.lineIndent<o)&&l===32;)this.lineIndent++,l=this.next();if(!r&&this.lineIndent>o&&(o=this.lineIndent),x(l)){a++;continue}if(this.lineIndent<o){n===Ue?this.result+=`
`.repeat(i?1+a:a):n===te&&i&&(this.result+=`
`);break}f?T(l)?(c=!0,this.result+=`
`.repeat(i?1+a:a)):c?(c=!1,this.result+=`
`.repeat(a+1)):a===0?i&&(this.result+=" "):this.result+=`
`.repeat(a):this.result+=`
`.repeat(i?1+a:a),i=!0,r=!0,a=0;let p=this.position;for(;!x(l)&&l!==0;)l=this.next();this.captureSegment(p,this.position,!1)}return!0}readBlockMapping(t,n){let i=this.tag,r=this.anchor,o={},a=new Set,c=!1,l,f,u=null,p=null,d=null,h=!1,y=!1;this.anchor!==null&&typeof this.anchor<"u"&&this.anchorMap.set(this.anchor,o);let m=this.peek();for(;m!==0;){let E=this.peek(1);if(l=this.line,f=this.position,(m===63||m===58)&&g(E)){if(m===63)h&&(this.storeMappingPair(o,a,u,p,null),u=null,p=null,d=null),y=!0,h=!0,c=!0;else if(h)h=!1,c=!0;else throw this.#e("Cannot read block as explicit mapping pair is incomplete: a key node is missed or followed by a non-tabulated empty line");this.position+=1,m=E}else if(this.composeNode({parentIndent:n,nodeContext:Fe,allowToSeek:!1,allowCompact:!0}))if(this.line===l)if(m=this.peek(),this.skipWhitespaces(),m=this.peek(),m===58){if(m=this.next(),!g(m))throw this.#e("Cannot read block: a whitespace character is expected after the key-value separator within a block mapping");h&&(this.storeMappingPair(o,a,u,p,null),u=null,p=null,d=null),y=!0,h=!1,c=!1,u=this.tag,p=this.result}else{if(y)throw this.#e("Cannot read an implicit mapping pair: missing colon");return this.tag=i,this.anchor=r,!0}else{if(y)throw this.#e("Cannot read a block mapping entry: a multiline key may not be an implicit key");return this.tag=i,this.anchor=r,!0}else break;if((this.line===l||this.lineIndent>t)&&(this.composeNode({parentIndent:t,nodeContext:q,allowToSeek:!0,allowCompact:c})&&(h?p=this.result:d=this.result),h||(this.storeMappingPair(o,a,u,p,d,l,f),u=p=d=null),this.skipSeparationSpace(!0,-1),m=this.peek()),this.lineIndent>t&&m!==0)throw this.#e("Cannot read block: bad indentation of a mapping entry");if(this.lineIndent<t)break}return h&&this.storeMappingPair(o,a,u,p,null),y&&(this.tag=i,this.anchor=r,this.kind="mapping",this.result=o),y}readTagProperty(){let t=!1,n=!1,i="",r,o=this.peek();if(o!==33)return!1;if(this.tag!==null)throw this.#e("Cannot read tag property: duplication of a tag property");o=this.next(),o===60?(t=!0,o=this.next()):o===33?(n=!0,i="!!",o=this.next()):i="!";let a=this.position;if(t){do o=this.next();while(o!==0&&o!==62);if(this.position<this.length)r=this.input.slice(a,this.position),o=this.next();else throw this.#e("Cannot read tag property: unexpected end of stream")}else{for(;o!==0&&!g(o);){if(o===33){if(n)throw this.#e("Cannot read tag property: tag suffix cannot contain an exclamation mark");if(i=this.input.slice(a-1,this.position+1),!Be.test(i))throw this.#e("Cannot read tag property: named tag handle contains invalid characters");n=!0,a=this.position+1}o=this.next()}if(r=this.input.slice(a,this.position),Lr.test(r))throw this.#e("Cannot read tag property: tag suffix cannot contain flow indicator characters")}if(r&&!$e.test(r))throw this.#e(`Cannot read tag property: invalid characters in tag name "${r}"`);if(t)this.tag=r;else if(this.tagMap.has(i))this.tag=this.tagMap.get(i)+r;else if(i==="!")this.tag=`!${r}`;else if(i==="!!")this.tag=`tag:yaml.org,2002:${r}`;else throw this.#e(`Cannot read tag property: undeclared tag handle "${i}"`);return!0}readAnchorProperty(){let t=this.peek();if(t!==38)return!1;if(this.anchor!==null)throw this.#e("Cannot read anchor property: duplicate anchor property");t=this.next();let n=this.position;for(;t!==0&&!g(t)&&!k(t);)t=this.next();if(this.position===n)throw this.#e("Cannot read anchor property: name of an anchor node must contain at least one character");return this.anchor=this.input.slice(n,this.position),!0}readAlias(){if(this.peek()!==42)return!1;let t=this.next(),n=this.position;for(;t!==0&&!g(t)&&!k(t);)t=this.next();if(this.position===n)throw this.#e("Cannot read alias: alias name must contain at least one character");let i=this.input.slice(n,this.position);if(!this.anchorMap.has(i))throw this.#e(`Cannot read alias: unidentified alias "${i}"`);return this.result=this.anchorMap.get(i),this.skipSeparationSpace(!0,-1),!0}composeNode({parentIndent:t,nodeContext:n,allowToSeek:i,allowCompact:r}){let o=1,a=!1,c=!1,l;this.tag=null,this.anchor=null,this.kind=null,this.result=null;let f=q===n||De===n,u=f,p=f;if(i&&this.skipSeparationSpace(!0,-1)&&(a=!0,this.lineIndent>t?o=1:this.lineIndent===t?o=0:this.lineIndent<t&&(o=-1)),o===1)for(;this.readTagProperty()||this.readAnchorProperty();)this.skipSeparationSpace(!0,-1)?(a=!0,u=p,this.lineIndent>t?o=1:this.lineIndent===t?o=0:this.lineIndent<t&&(o=-1)):u=!1;if(u&&(u=a||r),o===1||q===n){let h=W===n||Fe===n?t:t+1,y=this.position-this.lineStart;if(o===1)if(u&&(this.readBlockSequence(y)||this.readBlockMapping(y,h))||this.readFlowCollection(h))c=!0;else{if(f&&this.readBlockScalar(h)||this.readSingleQuotedScalar(h)||this.readDoubleQuotedScalar(h))c=!0;else if(this.readAlias()){if(c=!0,this.tag!==null||this.anchor!==null)throw this.#e("Cannot compose node: alias node should not have any properties")}else this.readPlainScalar(h,W===n)&&(c=!0,this.tag===null&&(this.tag="?"));this.anchor!==null&&this.anchorMap.set(this.anchor,this.result)}else o===0&&(c=u&&this.readBlockSequence(y))}if(this.tag!==null&&this.tag!=="!")if(this.tag==="?"){for(let d=0;d<this.implicitTypes.length;d++)if(l=this.implicitTypes[d],l.resolve(this.result)){this.result=l.construct(this.result),this.tag=l.tag,this.anchor!==null&&this.anchorMap.set(this.anchor,this.result);break}}else if(this.typeMap[this.kind??"fallback"].has(this.tag)){if(l=this.typeMap[this.kind??"fallback"].get(this.tag),this.result!==null&&l.kind!==this.kind)throw this.#e(`Unacceptable node kind for !<${this.tag}> tag: it should be "${l.kind}", not "${this.kind}"`);if(l.resolve(this.result))this.result=l.construct(this.result),this.anchor!==null&&this.anchorMap.set(this.anchor,this.result);else throw this.#e(`Cannot resolve a node with !<${this.tag}> explicit tag`)}else throw this.#e(`Cannot resolve unknown tag !<${this.tag}>`);return this.tag!==null||this.anchor!==null||c}readDocument(){let t=this.position,n=!1;this.version=null,this.checkLineBreaks=!1,this.tagMap=new Map,this.anchorMap=new Map;let i=this.peek();for(;i!==0&&(this.skipSeparationSpace(!0,-1),i=this.peek(),!(this.lineIndent>0||i!==37));){n=!0,i=this.next();let r=this.position;for(;i!==0&&!g(i);)i=this.next();let o=this.input.slice(r,this.position),a=[];if(o.length<1)throw this.#e("Cannot read document: directive name length must be greater than zero");for(;i!==0&&(this.skipWhitespaces(),this.skipComment(),i=this.peek(),!x(i));){for(r=this.position;i!==0&&!g(i);)i=this.next();a.push(this.input.slice(r,this.position))}switch(i!==0&&this.readLineBreak(),o){case"YAML":this.yamlDirectiveHandler(...a);break;case"TAG":this.tagDirectiveHandler(...a);break;default:this.dispatchWarning(`unknown document directive "${o}"`);break}i=this.peek()}if(this.skipSeparationSpace(!0,-1),this.lineIndent===0&&this.peek()===45&&this.peek(1)===45&&this.peek(2)===45)this.position+=3,this.skipSeparationSpace(!0,-1);else if(n)throw this.#e("Cannot read document: directives end mark is expected");if(this.composeNode({parentIndent:this.lineIndent-1,nodeContext:q,allowToSeek:!1,allowCompact:!0}),this.skipSeparationSpace(!0,-1),this.checkLineBreaks&&Mr.test(this.input.slice(t,this.position))&&this.dispatchWarning("non-ASCII line breaks are interpreted as content"),this.position===this.lineStart&&this.testDocumentSeparator())this.peek()===46&&(this.position+=3,this.skipSeparationSpace(!0,-1));else if(this.position<this.length-1)throw this.#e("Cannot read document: end of the stream or a document separator is expected");return this.result}*readDocuments(){for(;this.position<this.length-1;)yield this.readDocument()}};function Dr(e){return e=String(e),e.length>0&&(x(e.charCodeAt(e.length-1))||(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1))),e+="\0",e}function ae(e,t={}){e=Dr(e);let i=new Q(e,{...t,schema:ee.get(t.schema)}).readDocuments(),r=i.next().value;if(!i.next().done)throw new SyntaxError("Found more than 1 document in the stream: expected a single document");return r??null}var Ur="spools.yaml",Br="jobs.yaml";async function ze(){let e=await tt(),t=`<div class='silverspooler spools'>
  <table>
  <thead>
    <tr>
      <td>Brand</td>
      <td>Material</td>
      <td>Color</td>
      <td style='text-align: right;'>Remaining</td>
      <td></td>
    </tr>
  </thead>
  <tbody>`;return e.forEach(n=>{t+=`<tr class='${n.isRetired?"retired":"active"}'>
    <td>${n.brand}</td>
    <td>${n.material}</td>
    <td>${n.colorName}${n.isTranslucent?"/TL":""}</td>`,n.isRetired?t+="<td style='text-align: right;' class='remaining'>Retired</td>":t+=`<td style='text-align: right;' class='remaining' title="${n.grossWeight?"Gross: "+n.grossWeight:""}">${n.remainingWeight} / ${n.initialNetWeight}</td>`,t+=`<td>TODO</td>
    </tr>`}),t+=`</tbody>
  </table>
  </div>`,t}async function Ze(){let e=await nt(),t=`<div class='silverspooler printjobs'>
  <table>
  <thead>
    <tr>
      <td style='text-align: right;'>Date</td>
      <td>Description</td>
      <td colspan='3'>Spool</td>
      <td style='text-align: right;'>Used Weight</td>
      <td style='text-align: right;'>Duration</td>
      <td>Notes</td>
      <td></td>
    </tr>
  </thead>
  <tbody>`;return e.forEach(n=>{t+=`<tr>
    <td style='text-align: right;'>${new Date(n.date).toLocaleDateString()}</td>
    <td>${n.description}</td>
    <td>${n.spoolBrand}</td>
    <td>${n.spoolMaterial}</td>
    <td>${n.spoolColorName}</td>
    <td style='text-align: right;'>${n.filamentWeight}</td>
    <td style='text-align: right;'>${Wr(n.duration)}</td>
    <td>${n.notes?n.notes:""}</td>
    <td>TODO</td>
    </tr>`}),t+=`</tbody>
  </table>
  </div>`,t}async function et(){F=null,S=null,w=null,K.refreshAll(),B.flashNotification("SilverSpooler data refreshed.")}var S;async function tt(){if(S==null){let e=await rt(Ur);D("Loading spools from "+e);let t=it(await C.readDocument(e));le(t)?(S=await ae(t).spools,await $r(S)):S=new Array,D("Loaded spools: "+S.length)}return S}async function $r(e){let t=await nt();e.forEach(n=>{(n.remainingWeight===void 0||n.remainingWeight===null)&&(n.remainingWeight=n.initialNetWeight),t.forEach(i=>{i.spoolId===n.id&&(n.remainingWeight-=i.filamentWeight)})})}var w;async function nt(){if(w==null){let e=await rt(Br);D("Loading jobs from "+e);let t=it(await C.readDocument(e));le(t)?(w=await ae(t).jobs,await Kr(w)):w=new Array,D("Loaded jobs: "+w.length)}return w}async function Kr(e){let t=await tt();e.forEach(n=>{n.spoolBrand="n/a",n.spoolMaterial="n/a",n.spoolColor="n/a",t.forEach(i=>{i.id===n.spoolId&&(n.spoolBrand=i.brand,n.spoolMaterial=i.material,n.spoolColorName=i.colorName,n.spoolIsTranslucent=i.isTranslucent)})})}function Wr(e){let t=Math.floor(e/60),n=e%60,i=n<10?`0${n}`:`${n}`;return t>0?`${t}h ${i}m`:`${i}m`}async function rt(e){return(await qr()).pathPrefix+e}var F;async function qr(){if(F==null){D("Reading settings");let e=await $.getConfig("silverSpooler",{});le(e.pathPrefix)||(e.pathPrefix="Files/SilverSpooler/"),F=e}return F}function it(e,t="utf-8"){return new TextDecoder(t).decode(e)}function le(e){return typeof e=="string"&&e.length>0}function D(e){console.log("SilverSpooler: "+e)}var ot={renderSpools:ze,renderPrintJobs:Ze,refresh:et},st={name:"silverspooler",functions:{renderSpools:{path:"silverspooler.ts:renderSpools"},renderPrintJobs:{path:"silverspooler.ts:renderPrintJobs"},refresh:{path:"silverspooler.ts:refresh",command:{name:"SilverSpooler: Refresh"}}},assets:{}},Mo={manifest:st,functionMapping:ot};ue(ot,st,self.postMessage);export{Mo as plug};
