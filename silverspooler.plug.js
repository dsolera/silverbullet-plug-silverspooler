var $t=Object.defineProperty;var J=(e,t)=>{for(var n in t)$t(e,n,{get:t[n],enumerable:!0})};function Ce(e){let t=atob(e),n=t.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=t.charCodeAt(r);return i}function pe(e){typeof e=="string"&&(e=new TextEncoder().encode(e));let t="",n=e.byteLength;for(let i=0;i<n;i++)t+=String.fromCharCode(e[i]);return btoa(t)}var U=e=>{throw new Error("Not initialized yet")},he=typeof window>"u"&&typeof globalThis.WebSocketPair>"u";typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var de=new Map,fe=0;he&&(globalThis.syscall=async(e,...t)=>await new Promise((n,i)=>{fe++,de.set(fe,{resolve:n,reject:i}),U({type:"sys",id:fe,name:e,args:t})}));function Me(e,t,n){he&&(U=n,self.addEventListener("message",i=>{(async()=>{let r=i.data;switch(r.type){case"inv":{let o=e[r.name];if(!o)throw new Error(`Function not loaded: ${r.name}`);try{let a=await Promise.resolve(o(...r.args||[]));U({type:"invr",id:r.id,result:a})}catch(a){console.error("An exception was thrown as a result of invoking function",r.name,"error:",a.message),U({type:"invr",id:r.id,error:a.message})}}break;case"sysr":{let o=r.id,a=de.get(o);if(!a)throw Error("Invalid request id");de.delete(o),r.error?a.reject(new Error(r.error)):a.resolve(r.result)}break}})().catch(console.error)}),U({type:"manifest",manifest:t}))}async function Ut(e,t){if(typeof e!="string"){let n=new Uint8Array(await e.arrayBuffer()),i=n.length>0?pe(n):void 0;t={method:e.method,headers:Object.fromEntries(e.headers.entries()),base64Body:i},e=e.url}return syscall("sandboxFetch.fetch",e,t)}globalThis.nativeFetch=globalThis.fetch;function Bt(){globalThis.fetch=async function(e,t){let n=t&&t.body?pe(new Uint8Array(await new Response(t.body).arrayBuffer())):void 0,i=await Ut(e,t&&{method:t.method,headers:t.headers,base64Body:n});return new Response(i.base64Body?Ce(i.base64Body):null,{status:i.status,headers:i.headers})}}he&&Bt();var g={};J(g,{alert:()=>En,configureVimMode:()=>Wn,confirm:()=>Tn,copyToClipboard:()=>Fn,deleteLine:()=>Dn,dispatch:()=>kn,downloadFile:()=>cn,filterBox:()=>dn,flashNotification:()=>fn,fold:()=>Cn,foldAll:()=>Ln,getCurrentEditor:()=>Yt,getCurrentPage:()=>Wt,getCurrentPageMeta:()=>Kt,getCurrentPath:()=>qt,getCursor:()=>Qt,getRecentlyOpenedPages:()=>jt,getSelection:()=>Jt,getText:()=>Ht,getUiOption:()=>vn,goHistory:()=>un,hidePanel:()=>mn,insertAtCursor:()=>Sn,insertAtPos:()=>yn,invokeCommand:()=>Xt,moveCursor:()=>bn,moveCursorToLine:()=>wn,moveLineDown:()=>Un,moveLineUp:()=>$n,navigate:()=>Zt,newWindow:()=>ln,openCommandPalette:()=>tn,openPageNavigator:()=>en,openSearchPanel:()=>On,openUrl:()=>an,prompt:()=>Pn,rebuildEditorState:()=>on,redo:()=>_n,reloadConfigAndCommands:()=>sn,reloadPage:()=>nn,reloadUI:()=>rn,replaceRange:()=>xn,save:()=>zt,sendMessage:()=>Kn,setSelection:()=>Vt,setText:()=>Gt,setUiOption:()=>An,showPanel:()=>hn,showProgress:()=>gn,toggleFold:()=>In,undo:()=>Nn,unfold:()=>Mn,unfoldAll:()=>Rn,uploadFile:()=>pn,vimEx:()=>Bn});typeof self>"u"&&(self={syscall:()=>{throw new Error("Not implemented here")}});function u(e,...t){return globalThis.syscall(e,...t)}function Wt(){return u("editor.getCurrentPage")}function Kt(){return u("editor.getCurrentPageMeta")}function qt(e=!1){return u("editor.getCurrentPath",e)}function jt(){return u("editor.getRecentlyOpenedPages")}function Yt(){return u("editor.getCurrentEditor")}function Ht(){return u("editor.getText")}function Gt(e,t=!1){return u("editor.setText",e,t)}function Qt(){return u("editor.getCursor")}function Jt(){return u("editor.getSelection")}function Vt(e,t){return u("editor.setSelection",e,t)}function Xt(e,t){return u("editor.invokeCommand",e,t)}function zt(){return u("editor.save")}function Zt(e,t=!1,n=!1){return u("editor.navigate",e,t,n)}function en(e="page"){return u("editor.openPageNavigator",e)}function tn(){return u("editor.openCommandPalette")}function nn(){return u("editor.reloadPage")}function rn(){return u("editor.reloadUI")}function on(){return u("editor.rebuildEditorState")}function sn(){return u("editor.reloadConfigAndCommands")}function an(e,t=!1){return u("editor.openUrl",e,t)}function ln(){return u("editor.newWindow")}function un(e){return u("editor.goHistory",e)}function cn(e,t){return u("editor.downloadFile",e,t)}function pn(e,t){return u("editor.uploadFile",e,t)}function fn(e,t="info"){return u("editor.flashNotification",e,t)}function dn(e,t,n="",i=""){return u("editor.filterBox",e,t,n,i)}function hn(e,t,n,i=""){return u("editor.showPanel",e,t,n,i)}function mn(e){return u("editor.hidePanel",e)}function gn(e,t){return u("editor.showProgress",e,t)}function yn(e,t){return u("editor.insertAtPos",e,t)}function xn(e,t,n){return u("editor.replaceRange",e,t,n)}function bn(e,t=!1){return u("editor.moveCursor",e,t)}function wn(e,t=1,n=!1){return u("editor.moveCursorToLine",e,t,n)}function Sn(e,t=!1,n=!1){return u("editor.insertAtCursor",e,t,n)}function kn(e){return u("editor.dispatch",e)}function Pn(e,t=""){return u("editor.prompt",e,t)}function Tn(e){return u("editor.confirm",e)}function En(e){return u("editor.alert",e)}function vn(e){return u("editor.getUiOption",e)}function An(e,t){return u("editor.setUiOption",e,t)}function Cn(){return u("editor.fold")}function Mn(){return u("editor.unfold")}function In(){return u("editor.toggleFold")}function Ln(){return u("editor.foldAll")}function Rn(){return u("editor.unfoldAll")}function Nn(){return u("editor.undo")}function _n(){return u("editor.redo")}function On(){return u("editor.openSearchPanel")}function Fn(e){return u("editor.copyToClipboard",e)}function Dn(){return u("editor.deleteLine")}function $n(){return u("editor.moveLineUp")}function Un(){return u("editor.moveLineDown")}function Bn(e){return u("editor.vimEx",e)}function Wn(){return u("editor.configureVimMode")}function Kn(e,t){return u("editor.sendMessage",e,t)}var T={};J(T,{deleteDocument:()=>ti,deleteFile:()=>si,deletePage:()=>Jn,fileExists:()=>ai,getDocumentMeta:()=>zn,getFileMeta:()=>ri,getPageMeta:()=>Yn,listDocuments:()=>Xn,listFiles:()=>ni,listPages:()=>jn,listPlugs:()=>Vn,pageExists:()=>Hn,readDocument:()=>Zn,readFile:()=>ii,readPage:()=>Gn,writeDocument:()=>ei,writeFile:()=>oi,writePage:()=>Qn});function jn(){return u("space.listPages")}function Yn(e){return u("space.getPageMeta",e)}function Hn(e){return u("space.pageExists",e)}function Gn(e){return u("space.readPage",e)}function Qn(e,t){return u("space.writePage",e,t)}function Jn(e){return u("space.deletePage",e)}function Vn(){return u("space.listPlugs")}function Xn(){return u("space.listDocuments")}function zn(e){return u("space.getDocumentMeta",e)}function Zn(e){return u("space.readDocument",e)}function ei(e,t){return u("space.writeDocument",e,t)}function ti(e){return u("space.deleteDocument",e)}function ni(){return u("space.listFiles")}function ii(e){return u("space.readFile",e)}function ri(e){return u("space.getFileMeta",e)}function oi(e,t){return u("space.writeFile",e,t)}function si(e){return u("space.deleteFile",e)}function ai(e){return u("space.fileExists",e)}var V={};J(V,{getConfig:()=>mi,getMode:()=>di,getVersion:()=>hi,invokeCommand:()=>ui,invokeFunction:()=>li,listCommands:()=>ci,listSyscalls:()=>pi,reloadPlugs:()=>fi,wipeClient:()=>gi});function li(e,...t){return u("system.invokeFunction",e,...t)}function ui(e,t){return u("system.invokeCommand",e,t)}function ci(){return u("system.listCommands")}function pi(){return u("system.listSyscalls")}function fi(){return u("system.reloadPlugs")}function di(){return u("system.getMode")}function hi(){return u("system.getVersion")}function mi(e,t=void 0){return u("system.getConfig",e,t)}function gi(e=!1){return u("system.wipeClient",e)}var X={};J(X,{refreshAll:()=>wi});function wi(){return u("codeWidget.refreshAll")}function w(e){return e===10||e===13}function E(e){return e===9||e===32}function x(e){return E(e)||w(e)}function M(e){return e===44||e===91||e===93||e===123||e===125}var me=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function Ii(e){if(e===null)return!1;let t,n=0,i=e.length,r=me;for(let o=0;o<i;o++)if(t=r.indexOf(e.charAt(o)),!(t>64)){if(t<0)return!1;n+=6}return n%8===0}function Li(e){let t=e.replace(/[\r\n=]/g,""),n=t.length,i=me,r=[],o=0;for(let l=0;l<n;l++)l%4===0&&l&&(r.push(o>>16&255),r.push(o>>8&255),r.push(o&255)),o=o<<6|i.indexOf(t.charAt(l));let a=n%4*6;return a===0?(r.push(o>>16&255),r.push(o>>8&255),r.push(o&255)):a===18?(r.push(o>>10&255),r.push(o>>2&255)):a===12&&r.push(o>>4&255),new Uint8Array(r)}function Ri(e){let t=e.length,n=me,i="",r=0;for(let a=0;a<t;a++)a%3===0&&a&&(i+=n[r>>18&63],i+=n[r>>12&63],i+=n[r>>6&63],i+=n[r&63]),r=(r<<8)+e[a];let o=t%3;return o===0?(i+=n[r>>18&63],i+=n[r>>12&63],i+=n[r>>6&63],i+=n[r&63]):o===2?(i+=n[r>>10&63],i+=n[r>>4&63],i+=n[r<<2&63],i+=n[64]):o===1&&(i+=n[r>>2&63],i+=n[r<<4&63],i+=n[64],i+=n[64]),i}function Ni(e){return e instanceof Uint8Array}var Ie={tag:"tag:yaml.org,2002:binary",construct:Li,kind:"scalar",predicate:Ni,represent:Ri,resolve:Ii};var Le=["true","True","TRUE"],_i=["false","False","FALSE"],Oi=[...Le,..._i],Re={tag:"tag:yaml.org,2002:bool",kind:"scalar",defaultStyle:"lowercase",predicate:e=>typeof e=="boolean"||e instanceof Boolean,construct:e=>Le.includes(e),resolve:e=>Oi.includes(e),represent:{lowercase:e=>(e instanceof Boolean?e.valueOf():e)?"true":"false",uppercase:e=>(e instanceof Boolean?e.valueOf():e)?"TRUE":"FALSE",camelcase:e=>(e instanceof Boolean?e.valueOf():e)?"True":"False"}};function B(e){return e!==null&&typeof e=="object"}function W(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}function I(e){return Object.prototype.toString.call(e)==="[object Object]"}var Fi=new RegExp("^(?:[-+]?(?:0|[1-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function Di(e){return!(!Fi.test(e)||e[e.length-1]==="_")}function $i(e){let t=e.replace(/_/g,"").toLowerCase(),n=t[0]==="-"?-1:1;return t[0]&&"+-".includes(t[0])&&(t=t.slice(1)),t===".inf"?n===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t===".nan"?NaN:n*parseFloat(t)}var Ui=/^[-+]?[0-9]+e/;function Bi(e,t){let n=e instanceof Number?e.valueOf():e;if(isNaN(n))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===n)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===n)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(W(n))return"-0.0";let i=n.toString(10);return Ui.test(i)?i.replace("e",".e"):i}function Wi(e){return e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&(e%1!==0||W(e))}var Ne={tag:"tag:yaml.org,2002:float",construct:$i,defaultStyle:"lowercase",kind:"scalar",predicate:Wi,represent:Bi,resolve:Di};function K(e,t,n){return t<=e&&e<=n}function Ki(e){return K(e,48,57)||K(e,65,70)||K(e,97,102)}function qi(e){return K(e,48,55)}function ji(e){return K(e,48,57)}function Yi(e){let t=e.length,n=0,i=!1;if(!t)return!1;let r=e[n];if((r==="-"||r==="+")&&(r=e[++n]),r==="0"){if(n+1===t)return!0;if(r=e[++n],r==="b"){for(n++;n<t;n++)if(r=e[n],r!=="_"){if(r!=="0"&&r!=="1")return!1;i=!0}return i&&r!=="_"}if(r==="x"){for(n++;n<t;n++)if(r=e[n],r!=="_"){if(!Ki(e.charCodeAt(n)))return!1;i=!0}return i&&r!=="_"}for(;n<t;n++)if(r=e[n],r!=="_"){if(!qi(e.charCodeAt(n)))return!1;i=!0}return i&&r!=="_"}if(r==="_")return!1;for(;n<t;n++)if(r=e[n],r!=="_"){if(!ji(e.charCodeAt(n)))return!1;i=!0}return!i||r==="_"?!1:/^(:[0-5]?[0-9])+$/.test(e.slice(n))}function Hi(e){let t=e;t.includes("_")&&(t=t.replace(/_/g,""));let n=1,i=t[0];return(i==="-"||i==="+")&&(i==="-"&&(n=-1),t=t.slice(1),i=t[0]),t==="0"?0:i==="0"?t[1]==="b"?n*parseInt(t.slice(2),2):t[1]==="x"?n*parseInt(t,16):n*parseInt(t,8):n*parseInt(t,10)}function Gi(e){return e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&e%1===0&&!W(e)}var _e={tag:"tag:yaml.org,2002:int",construct:Hi,defaultStyle:"decimal",kind:"scalar",predicate:Gi,represent:{binary(e){let t=e instanceof Number?e.valueOf():e;return t>=0?`0b${t.toString(2)}`:`-0b${t.toString(2).slice(1)}`},octal(e){let t=e instanceof Number?e.valueOf():e;return t>=0?`0${t.toString(8)}`:`-0${t.toString(8).slice(1)}`},decimal(e){return(e instanceof Number?e.valueOf():e).toString(10)},hexadecimal(e){let t=e instanceof Number?e.valueOf():e;return t>=0?`0x${t.toString(16).toUpperCase()}`:`-0x${t.toString(16).toUpperCase().slice(1)}`}},resolve:Yi};var Oe={tag:"tag:yaml.org,2002:map",resolve(){return!0},construct(e){return e!==null?e:{}},kind:"mapping"};var Fe={tag:"tag:yaml.org,2002:merge",kind:"scalar",resolve:e=>e==="<<"||e===null,construct:e=>e};var De={tag:"tag:yaml.org,2002:null",kind:"scalar",defaultStyle:"lowercase",predicate:e=>e===null,construct:()=>null,resolve:e=>e==="~"||e==="null"||e==="Null"||e==="NULL",represent:{lowercase:()=>"null",uppercase:()=>"NULL",camelcase:()=>"Null"}};function Qi(e){let t=new Set;for(let n of e){if(!I(n))return!1;let i=Object.keys(n);if(i.length!==1)return!1;for(let r of i){if(t.has(r))return!1;t.add(r)}}return!0}var $e={tag:"tag:yaml.org,2002:omap",kind:"sequence",resolve:Qi,construct(e){return e}};function Ji(e){return e===null?!0:e.every(t=>I(t)&&Object.keys(t).length===1)}var Ue={tag:"tag:yaml.org,2002:pairs",construct(e){return e?.flatMap(Object.entries)??[]},kind:"sequence",resolve:Ji};var Be=/^\/(?<regexp>[\s\S]+)\/(?<modifiers>[gismuy]*)$/,We={tag:"tag:yaml.org,2002:js/regexp",kind:"scalar",resolve(e){if(e===null||!e.length)return!1;if(e.charAt(0)==="/"){let t=e.match(Be)?.groups;if(!t)return!1;let n=t.modifiers??"";if(new Set(n).size<n.length)return!1}return!0},construct(e){let{regexp:t=e,modifiers:n=""}=e.match(Be)?.groups??{};return new RegExp(t,n)},predicate:e=>e instanceof RegExp,represent:e=>e.toString()};var Ke={tag:"tag:yaml.org,2002:seq",kind:"sequence",resolve:()=>!0,construct:e=>e!==null?e:[]};var qe={tag:"tag:yaml.org,2002:set",kind:"mapping",construct:e=>e!==null?e:{},resolve:e=>e===null?!0:Object.values(e).every(t=>t===null)};var je={tag:"tag:yaml.org,2002:str",kind:"scalar",resolve:()=>!0,construct:e=>e!==null?e:""};var Ye=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),He=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function Vi(e){return e===null?!1:Ye.exec(e)!==null||He.exec(e)!==null}function Xi(e){let t=Ye.exec(e);if(t===null&&(t=He.exec(e)),t===null)throw new Error("Cannot construct YAML timestamp: date resolve error");let n=+t[1],i=+t[2]-1,r=+t[3];if(!t[4])return new Date(Date.UTC(n,i,r));let o=+t[4],a=+t[5],l=+t[6],s=0;if(t[7]){let d=t[7].slice(0,3);for(;d.length<3;)d+="0";s=+d}let p=null;if(t[9]&&t[10]){let d=+t[10],h=+(t[11]||0);p=(d*60+h)*6e4,t[9]==="-"&&(p=-p)}let f=new Date(Date.UTC(n,i,r,o,a,l,s));return p&&f.setTime(f.getTime()-p),f}function zi(e){return e.toISOString()}var Ge={tag:"tag:yaml.org,2002:timestamp",construct:Xi,predicate(e){return e instanceof Date},kind:"scalar",represent:zi,resolve:Vi};var Qe={tag:"tag:yaml.org,2002:js/undefined",kind:"scalar",resolve(){return!0},construct(){},predicate(e){return typeof e>"u"},represent(){return""}};function Zi(e,t){let n={fallback:new Map,mapping:new Map,scalar:new Map,sequence:new Map},i=n.fallback;for(let r of[...e,...t])n[r.kind].set(r.tag,r),i.set(r.tag,r);return n}function q({explicitTypes:e=[],implicitTypes:t=[],include:n}){n&&(t.push(...n.implicitTypes),e.push(...n.explicitTypes));let i=Zi(t,e);return{implicitTypes:t,explicitTypes:e,typeMap:i}}var Je=q({explicitTypes:[je,Ke,Oe]}),Ve=q({implicitTypes:[De,Re,_e,Ne],include:Je}),Xe=q({include:Ve}),N=q({explicitTypes:[Ie,$e,Ue,qe],implicitTypes:[Ge,Fe],include:Xe}),er=q({explicitTypes:[We,Qe],include:N}),z=new Map([["core",Xe],["default",N],["failsafe",Je],["json",Ve],["extended",er]]);var Z=1,tt=2,nt=3,ee=4,ge=1,rr=2,it=3,or=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,sr=/[\x85\u2028\u2029]/,ar=/[,\[\]\{\}]/,rt=/^(?:!|!!|![a-z\-]+!)$/i,ot=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i,lr=new Map([[120,2],[117,4],[85,8]]),st=new Map([[48,"\0"],[97,"\x07"],[98,"\b"],[116,"	"],[9,"	"],[110,`
`],[118,"\v"],[102,"\f"],[114,"\r"],[101,"\x1B"],[32," "],[34,'"'],[47,"/"],[92,"\\"],[78,"\x85"],[95,"\xA0"],[76,"\u2028"],[80,"\u2029"]]);function ur(e){if(48<=e&&e<=57)return e-48;let t=e|32;return 97<=t&&t<=102?t-97+10:-1}function cr(e){return 48<=e&&e<=57?e-48:-1}function pr(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var at=4,lt=75,ut=`\0\r
\x85\u2028\u2029`;function fr(e,t){if(!e)return null;let n=t,i=t,r="",o="";for(;n>0&&!ut.includes(e.charAt(n-1));)if(n--,t-n>lt/2-1){r=" ... ",n+=5;break}for(;i<e.length&&!ut.includes(e.charAt(i));)if(i++,i-t>lt/2-1){o=" ... ",i-=5;break}let a=e.slice(n,i),l=" ".repeat(at),s=" ".repeat(at+t-n+r.length);return`${l+r+a+o}
${s}^`}function dr(e,t,n,i){let r=`at line ${n+1}, column ${i+1}`,o=fr(e,t);return o&&(r+=`:
${o}`),r}var oe=class{input;length;lineIndent=0;lineStart=0;position=0;line=0;onWarning;allowDuplicateKeys;implicitTypes;typeMap;version;checkLineBreaks=!1;tagMap=new Map;anchorMap=new Map;tag;anchor;kind;result="";constructor(t,{schema:n=N,onWarning:i,allowDuplicateKeys:r=!1}){this.input=t,this.onWarning=i,this.allowDuplicateKeys=r,this.implicitTypes=n.implicitTypes,this.typeMap=n.typeMap,this.length=t.length,this.version=null,this.readIndent()}skipWhitespaces(){let t=this.peek();for(;E(t);)t=this.next()}skipComment(){let t=this.peek();if(t===35)for(t=this.next();t!==0&&!w(t);)t=this.next()}readIndent(){let t=this.peek();for(;t===32;)this.lineIndent+=1,t=this.next()}peek(t=0){return this.input.charCodeAt(this.position+t)}next(){return this.position+=1,this.peek()}#e(t){let n=dr(this.input,this.position,this.line,this.position-this.lineStart);return new SyntaxError(`${t} ${n}`)}dispatchWarning(t){let n=this.#e(t);this.onWarning?.(n)}yamlDirectiveHandler(...t){if(this.version!==null)throw this.#e("Cannot handle YAML directive: duplication of %YAML directive");if(t.length!==1)throw this.#e("Cannot handle YAML directive: YAML directive accepts exactly one argument");let n=/^([0-9]+)\.([0-9]+)$/.exec(t[0]);if(n===null)throw this.#e("Cannot handle YAML directive: ill-formed argument");let i=parseInt(n[1],10),r=parseInt(n[2],10);if(i!==1)throw this.#e("Cannot handle YAML directive: unacceptable YAML version");if(this.version=t[0]??null,this.checkLineBreaks=r<2,r!==1&&r!==2)return this.dispatchWarning("Cannot handle YAML directive: unsupported YAML version")}tagDirectiveHandler(...t){if(t.length!==2)throw this.#e(`Cannot handle tag directive: directive accepts exactly two arguments, received ${t.length}`);let n=t[0],i=t[1];if(!rt.test(n))throw this.#e(`Cannot handle tag directive: ill-formed handle (first argument) in "${n}"`);if(this.tagMap.has(n))throw this.#e(`Cannot handle tag directive: previously declared suffix for "${n}" tag handle`);if(!ot.test(i))throw this.#e("Cannot handle tag directive: ill-formed tag prefix (second argument) of the TAG directive");this.tagMap.set(n,i)}captureSegment(t,n,i){if(t<n){let r=this.input.slice(t,n);if(i)for(let o=0;o<r.length;o++){let a=r.charCodeAt(o);if(!(a===9||32<=a&&a<=1114111))throw this.#e(`Expected valid JSON character: received "${a}"`)}else if(or.test(r))throw this.#e("Stream contains non-printable characters");this.result+=r}}readBlockSequence(t){let n=!1,i=this.tag,r=this.anchor,o=[];this.anchor!==null&&typeof this.anchor<"u"&&this.anchorMap.set(this.anchor,o);let a=this.peek();for(;a!==0&&a===45;){let l=this.peek(1);if(!x(l))break;if(n=!0,this.position++,this.skipSeparationSpace(!0,-1)&&this.lineIndent<=t){o.push(null),a=this.peek();continue}let s=this.line;if(this.composeNode({parentIndent:t,nodeContext:nt,allowToSeek:!1,allowCompact:!0}),o.push(this.result),this.skipSeparationSpace(!0,-1),a=this.peek(),(this.line===s||this.lineIndent>t)&&a!==0)throw this.#e("Cannot read block sequence: bad indentation of a sequence entry");if(this.lineIndent<t)break}return n?(this.tag=i,this.anchor=r,this.kind="sequence",this.result=o,!0):!1}mergeMappings(t,n,i){if(!B(n))throw this.#e("Cannot merge mappings: the provided source object is unacceptable");for(let[r,o]of Object.entries(n))Object.hasOwn(t,r)||(Object.defineProperty(t,r,{value:o,writable:!0,enumerable:!0,configurable:!0}),i.add(r))}storeMappingPair(t,n,i,r,o,a,l){if(Array.isArray(r)){r=Array.prototype.slice.call(r);for(let s=0;s<r.length;s++){if(Array.isArray(r[s]))throw this.#e("Cannot store mapping pair: nested arrays are not supported inside keys");typeof r=="object"&&I(r[s])&&(r[s]="[object Object]")}}if(typeof r=="object"&&I(r)&&(r="[object Object]"),r=String(r),i==="tag:yaml.org,2002:merge")if(Array.isArray(o))for(let s=0;s<o.length;s++)this.mergeMappings(t,o[s],n);else this.mergeMappings(t,o,n);else{if(!this.allowDuplicateKeys&&!n.has(r)&&Object.hasOwn(t,r))throw this.line=a||this.line,this.position=l||this.position,this.#e("Cannot store mapping pair: duplicated key");Object.defineProperty(t,r,{value:o,writable:!0,enumerable:!0,configurable:!0}),n.delete(r)}return t}readLineBreak(){let t=this.peek();if(t===10)this.position++;else if(t===13)this.position++,this.peek()===10&&this.position++;else throw this.#e("Cannot read line: line break not found");this.line+=1,this.lineStart=this.position}skipSeparationSpace(t,n){let i=0,r=this.peek();for(;r!==0&&(this.skipWhitespaces(),r=this.peek(),t&&(this.skipComment(),r=this.peek()),w(r));)this.readLineBreak(),r=this.peek(),i++,this.lineIndent=0,this.readIndent(),r=this.peek();return n!==-1&&i!==0&&this.lineIndent<n&&this.dispatchWarning("deficient indentation"),i}testDocumentSeparator(){let t=this.peek();return!!((t===45||t===46)&&t===this.peek(1)&&t===this.peek(2)&&(t=this.peek(3),t===0||x(t)))}writeFoldedLines(t){t===1?this.result+=" ":t>1&&(this.result+=`
`.repeat(t-1))}readPlainScalar(t,n){let i=this.kind,r=this.result,o=this.peek();if(x(o)||M(o)||o===35||o===38||o===42||o===33||o===124||o===62||o===39||o===34||o===37||o===64||o===96)return!1;let a;if((o===63||o===45)&&(a=this.peek(1),x(a)||n&&M(a)))return!1;this.kind="scalar",this.result="";let l=this.position,s=this.position,p=!1,f=0;for(;o!==0;){if(o===58){if(a=this.peek(1),x(a)||n&&M(a))break}else if(o===35){let d=this.peek(-1);if(x(d))break}else{if(this.position===this.lineStart&&this.testDocumentSeparator()||n&&M(o))break;if(w(o)){f=this.line;let d=this.lineStart,h=this.lineIndent;if(this.skipSeparationSpace(!1,-1),this.lineIndent>=t){p=!0,o=this.peek();continue}else{this.position=l,this.line=f,this.lineStart=d,this.lineIndent=h;break}}}p&&(this.captureSegment(s,l,!1),this.writeFoldedLines(this.line-f),s=l=this.position,p=!1),E(o)||(l=this.position+1),o=this.next()}return this.captureSegment(s,l,!1),this.result?!0:(this.kind=i,this.result=r,!1)}readSingleQuotedScalar(t){let n=this.peek();if(n!==39)return!1;this.kind="scalar",this.result="",this.position++;let i=this.position,r=this.position;for(n=this.peek();n!==0;){if(n===39)if(this.captureSegment(i,this.position,!0),n=this.next(),n===39)i=this.position,this.position++,r=this.position;else return!0;else if(w(n))this.captureSegment(i,r,!0),this.writeFoldedLines(this.skipSeparationSpace(!1,t)),i=r=this.position;else{if(this.position===this.lineStart&&this.testDocumentSeparator())throw this.#e("Unexpected end of the document within a single quoted scalar");this.position++,r=this.position}n=this.peek()}throw this.#e("Unexpected end of the stream within a single quoted scalar")}readDoubleQuotedScalar(t){let n=this.peek();if(n!==34)return!1;this.kind="scalar",this.result="",this.position++;let i=this.position,r=this.position,o;for(n=this.peek();n!==0;){if(n===34)return this.captureSegment(r,this.position,!0),this.position++,!0;if(n===92){if(this.captureSegment(r,this.position,!0),n=this.next(),w(n))this.skipSeparationSpace(!1,t);else if(n<256&&st.has(n))this.result+=st.get(n),this.position++;else if((o=lr.get(n)??0)>0){let a=o,l=0;for(;a>0;a--)if(n=this.next(),(o=ur(n))>=0)l=(l<<4)+o;else throw this.#e("Cannot read double quoted scalar: expected hexadecimal character");this.result+=pr(l),this.position++}else throw this.#e("Cannot read double quoted scalar: unknown escape sequence");r=i=this.position}else if(w(n))this.captureSegment(r,i,!0),this.writeFoldedLines(this.skipSeparationSpace(!1,t)),r=i=this.position;else{if(this.position===this.lineStart&&this.testDocumentSeparator())throw this.#e("Unexpected end of the document within a double quoted scalar");this.position++,i=this.position}n=this.peek()}throw this.#e("Unexpected end of the stream within a double quoted scalar")}readFlowCollection(t){let n=this.peek(),i,r=!0,o={};if(n===91)i=93,r=!1,o=[];else if(n===123)i=125;else return!1;this.anchor!==null&&typeof this.anchor<"u"&&this.anchorMap.set(this.anchor,o),n=this.next();let a=this.tag,l=this.anchor,s=!0,p=null,f=null,d=null,h=!1,c=!1,m=0,y=0,$=new Set;for(;n!==0;){if(this.skipSeparationSpace(!0,t),n=this.peek(),n===i)return this.position++,this.tag=a,this.anchor=l,this.kind=r?"mapping":"sequence",this.result=o,!0;if(!s)throw this.#e("Cannot read flow collection: missing comma between flow collection entries");d=f=p=null,c=h=!1,n===63&&(m=this.peek(1),x(m)&&(c=h=!0,this.position++,this.skipSeparationSpace(!0,t))),y=this.line,this.composeNode({parentIndent:t,nodeContext:Z,allowToSeek:!1,allowCompact:!0}),d=this.tag||null,f=this.result,this.skipSeparationSpace(!0,t),n=this.peek(),(h||this.line===y)&&n===58&&(c=!0,n=this.next(),this.skipSeparationSpace(!0,t),this.composeNode({parentIndent:t,nodeContext:Z,allowToSeek:!1,allowCompact:!0}),p=this.result),r?this.storeMappingPair(o,$,d,f,p):c?o.push(this.storeMappingPair({},$,d,f,p)):o.push(f),this.skipSeparationSpace(!0,t),n=this.peek(),n===44?(s=!0,n=this.next()):s=!1}throw this.#e("Cannot read flow collection: unexpected end of the stream within a flow collection")}readBlockScalar(t){let n=ge,i=!1,r=!1,o=t,a=0,l=!1,s=this.peek(),p=!1;if(s===124)p=!1;else if(s===62)p=!0;else return!1;this.kind="scalar",this.result="";let f=0;for(;s!==0;)if(s=this.next(),s===43||s===45)if(ge===n)n=s===43?it:rr;else throw this.#e("Cannot read block: chomping mode identifier repeated");else if((f=cr(s))>=0){if(f===0)throw this.#e("Cannot read block: indentation width must be greater than 0");if(!r)o=t+f-1,r=!0;else throw this.#e("Cannot read block: indentation width identifier repeated")}else break;for(E(s)&&(this.skipWhitespaces(),this.skipComment(),s=this.peek());s!==0;){for(this.readLineBreak(),this.lineIndent=0,s=this.peek();(!r||this.lineIndent<o)&&s===32;)this.lineIndent++,s=this.next();if(!r&&this.lineIndent>o&&(o=this.lineIndent),w(s)){a++;continue}if(this.lineIndent<o){n===it?this.result+=`
`.repeat(i?1+a:a):n===ge&&i&&(this.result+=`
`);break}p?E(s)?(l=!0,this.result+=`
`.repeat(i?1+a:a)):l?(l=!1,this.result+=`
`.repeat(a+1)):a===0?i&&(this.result+=" "):this.result+=`
`.repeat(a):this.result+=`
`.repeat(i?1+a:a),i=!0,r=!0,a=0;let d=this.position;for(;!w(s)&&s!==0;)s=this.next();this.captureSegment(d,this.position,!1)}return!0}readBlockMapping(t,n){let i=this.tag,r=this.anchor,o={},a=new Set,l=!1,s,p,f=null,d=null,h=null,c=!1,m=!1;this.anchor!==null&&typeof this.anchor<"u"&&this.anchorMap.set(this.anchor,o);let y=this.peek();for(;y!==0;){let $=this.peek(1);if(s=this.line,p=this.position,(y===63||y===58)&&x($)){if(y===63)c&&(this.storeMappingPair(o,a,f,d,null),f=null,d=null,h=null),m=!0,c=!0,l=!0;else if(c)c=!1,l=!0;else throw this.#e("Cannot read block as explicit mapping pair is incomplete: a key node is missed or followed by a non-tabulated empty line");this.position+=1,y=$}else if(this.composeNode({parentIndent:n,nodeContext:tt,allowToSeek:!1,allowCompact:!0}))if(this.line===s)if(y=this.peek(),this.skipWhitespaces(),y=this.peek(),y===58){if(y=this.next(),!x(y))throw this.#e("Cannot read block: a whitespace character is expected after the key-value separator within a block mapping");c&&(this.storeMappingPair(o,a,f,d,null),f=null,d=null,h=null),m=!0,c=!1,l=!1,f=this.tag,d=this.result}else{if(m)throw this.#e("Cannot read an implicit mapping pair: missing colon");return this.tag=i,this.anchor=r,!0}else{if(m)throw this.#e("Cannot read a block mapping entry: a multiline key may not be an implicit key");return this.tag=i,this.anchor=r,!0}else break;if((this.line===s||this.lineIndent>t)&&(this.composeNode({parentIndent:t,nodeContext:ee,allowToSeek:!0,allowCompact:l})&&(c?d=this.result:h=this.result),c||(this.storeMappingPair(o,a,f,d,h,s,p),f=d=h=null),this.skipSeparationSpace(!0,-1),y=this.peek()),this.lineIndent>t&&y!==0)throw this.#e("Cannot read block: bad indentation of a mapping entry");if(this.lineIndent<t)break}return c&&this.storeMappingPair(o,a,f,d,null),m&&(this.tag=i,this.anchor=r,this.kind="mapping",this.result=o),m}readTagProperty(){let t=!1,n=!1,i="",r,o=this.peek();if(o!==33)return!1;if(this.tag!==null)throw this.#e("Cannot read tag property: duplication of a tag property");o=this.next(),o===60?(t=!0,o=this.next()):o===33?(n=!0,i="!!",o=this.next()):i="!";let a=this.position;if(t){do o=this.next();while(o!==0&&o!==62);if(this.position<this.length)r=this.input.slice(a,this.position),o=this.next();else throw this.#e("Cannot read tag property: unexpected end of stream")}else{for(;o!==0&&!x(o);){if(o===33){if(n)throw this.#e("Cannot read tag property: tag suffix cannot contain an exclamation mark");if(i=this.input.slice(a-1,this.position+1),!rt.test(i))throw this.#e("Cannot read tag property: named tag handle contains invalid characters");n=!0,a=this.position+1}o=this.next()}if(r=this.input.slice(a,this.position),ar.test(r))throw this.#e("Cannot read tag property: tag suffix cannot contain flow indicator characters")}if(r&&!ot.test(r))throw this.#e(`Cannot read tag property: invalid characters in tag name "${r}"`);if(t)this.tag=r;else if(this.tagMap.has(i))this.tag=this.tagMap.get(i)+r;else if(i==="!")this.tag=`!${r}`;else if(i==="!!")this.tag=`tag:yaml.org,2002:${r}`;else throw this.#e(`Cannot read tag property: undeclared tag handle "${i}"`);return!0}readAnchorProperty(){let t=this.peek();if(t!==38)return!1;if(this.anchor!==null)throw this.#e("Cannot read anchor property: duplicate anchor property");t=this.next();let n=this.position;for(;t!==0&&!x(t)&&!M(t);)t=this.next();if(this.position===n)throw this.#e("Cannot read anchor property: name of an anchor node must contain at least one character");return this.anchor=this.input.slice(n,this.position),!0}readAlias(){if(this.peek()!==42)return!1;let t=this.next(),n=this.position;for(;t!==0&&!x(t)&&!M(t);)t=this.next();if(this.position===n)throw this.#e("Cannot read alias: alias name must contain at least one character");let i=this.input.slice(n,this.position);if(!this.anchorMap.has(i))throw this.#e(`Cannot read alias: unidentified alias "${i}"`);return this.result=this.anchorMap.get(i),this.skipSeparationSpace(!0,-1),!0}composeNode({parentIndent:t,nodeContext:n,allowToSeek:i,allowCompact:r}){let o=1,a=!1,l=!1,s;this.tag=null,this.anchor=null,this.kind=null,this.result=null;let p=ee===n||nt===n,f=p,d=p;if(i&&this.skipSeparationSpace(!0,-1)&&(a=!0,this.lineIndent>t?o=1:this.lineIndent===t?o=0:this.lineIndent<t&&(o=-1)),o===1)for(;this.readTagProperty()||this.readAnchorProperty();)this.skipSeparationSpace(!0,-1)?(a=!0,f=d,this.lineIndent>t?o=1:this.lineIndent===t?o=0:this.lineIndent<t&&(o=-1)):f=!1;if(f&&(f=a||r),o===1||ee===n){let c=Z===n||tt===n?t:t+1,m=this.position-this.lineStart;if(o===1)if(f&&(this.readBlockSequence(m)||this.readBlockMapping(m,c))||this.readFlowCollection(c))l=!0;else{if(p&&this.readBlockScalar(c)||this.readSingleQuotedScalar(c)||this.readDoubleQuotedScalar(c))l=!0;else if(this.readAlias()){if(l=!0,this.tag!==null||this.anchor!==null)throw this.#e("Cannot compose node: alias node should not have any properties")}else this.readPlainScalar(c,Z===n)&&(l=!0,this.tag===null&&(this.tag="?"));this.anchor!==null&&this.anchorMap.set(this.anchor,this.result)}else o===0&&(l=f&&this.readBlockSequence(m))}if(this.tag!==null&&this.tag!=="!")if(this.tag==="?"){for(let h=0;h<this.implicitTypes.length;h++)if(s=this.implicitTypes[h],s.resolve(this.result)){this.result=s.construct(this.result),this.tag=s.tag,this.anchor!==null&&this.anchorMap.set(this.anchor,this.result);break}}else if(this.typeMap[this.kind??"fallback"].has(this.tag)){if(s=this.typeMap[this.kind??"fallback"].get(this.tag),this.result!==null&&s.kind!==this.kind)throw this.#e(`Unacceptable node kind for !<${this.tag}> tag: it should be "${s.kind}", not "${this.kind}"`);if(s.resolve(this.result))this.result=s.construct(this.result),this.anchor!==null&&this.anchorMap.set(this.anchor,this.result);else throw this.#e(`Cannot resolve a node with !<${this.tag}> explicit tag`)}else throw this.#e(`Cannot resolve unknown tag !<${this.tag}>`);return this.tag!==null||this.anchor!==null||l}readDocument(){let t=this.position,n=!1;this.version=null,this.checkLineBreaks=!1,this.tagMap=new Map,this.anchorMap=new Map;let i=this.peek();for(;i!==0&&(this.skipSeparationSpace(!0,-1),i=this.peek(),!(this.lineIndent>0||i!==37));){n=!0,i=this.next();let r=this.position;for(;i!==0&&!x(i);)i=this.next();let o=this.input.slice(r,this.position),a=[];if(o.length<1)throw this.#e("Cannot read document: directive name length must be greater than zero");for(;i!==0&&(this.skipWhitespaces(),this.skipComment(),i=this.peek(),!w(i));){for(r=this.position;i!==0&&!x(i);)i=this.next();a.push(this.input.slice(r,this.position))}switch(i!==0&&this.readLineBreak(),o){case"YAML":this.yamlDirectiveHandler(...a);break;case"TAG":this.tagDirectiveHandler(...a);break;default:this.dispatchWarning(`unknown document directive "${o}"`);break}i=this.peek()}if(this.skipSeparationSpace(!0,-1),this.lineIndent===0&&this.peek()===45&&this.peek(1)===45&&this.peek(2)===45)this.position+=3,this.skipSeparationSpace(!0,-1);else if(n)throw this.#e("Cannot read document: directives end mark is expected");if(this.composeNode({parentIndent:this.lineIndent-1,nodeContext:ee,allowToSeek:!1,allowCompact:!0}),this.skipSeparationSpace(!0,-1),this.checkLineBreaks&&sr.test(this.input.slice(t,this.position))&&this.dispatchWarning("non-ASCII line breaks are interpreted as content"),this.position===this.lineStart&&this.testDocumentSeparator())this.peek()===46&&(this.position+=3,this.skipSeparationSpace(!0,-1));else if(this.position<this.length-1)throw this.#e("Cannot read document: end of the stream or a document separator is expected");return this.result}*readDocuments(){for(;this.position<this.length-1;)yield this.readDocument()}};function hr(e){return e=String(e),e.length>0&&(w(e.charCodeAt(e.length-1))||(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1))),e+="\0",e}function Te(e,t={}){e=hr(e);let i=new oe(e,{...t,schema:z.get(t.schema)}).readDocuments(),r=i.next().value;if(!i.next().done)throw new SyntaxError("Found more than 1 document in the stream: expected a single document");return r??null}var yt=1,xt=2,bt=3,wt=4,G=5,mr=/^\n* /,gr=new Map([[0,"\\0"],[7,"\\a"],[8,"\\b"],[9,"\\t"],[10,"\\n"],[11,"\\v"],[12,"\\f"],[13,"\\r"],[27,"\\e"],[34,'\\"'],[92,"\\\\"],[133,"\\N"],[160,"\\_"],[8232,"\\L"],[8233,"\\P"]]),yr=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"];function ct(e){let t=e.toString(16).toUpperCase();if(e<=255)return`\\x${t.padStart(2,"0")}`;if(e<=65535)return`\\u${t.padStart(4,"0")}`;if(e<=4294967295)return`\\U${t.padStart(8,"0")}`;throw new Error("Code point within a string may not be greater than 0xFFFFFFFF")}function xr(e){let t=new Map;for(let n of Object.keys(e)){let i=String(e[n]);n.slice(0,2)==="!!"&&(n=`tag:yaml.org,2002:${n.slice(2)}`),t.set(n,i)}return t}function pt(e,t){let n=" ".repeat(t);return e.split(`
`).map(i=>i.length?n+i:i).join(`
`)}function ft(e,t){return`
${" ".repeat(e*t)}`}function se(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==65279||65536<=e&&e<=1114111}function Ee(e){return se(e)&&e!==65279&&e!==44&&e!==91&&e!==93&&e!==123&&e!==125&&e!==58&&e!==35}function br(e){return Ee(e)&&!E(e)&&e!==45&&e!==63&&e!==38&&e!==42&&e!==33&&e!==124&&e!==62&&e!==39&&e!==34&&e!==37&&e!==64&&e!==96}function St(e){return mr.test(e)}function wr(e,t,n,i,r,o){let a=i!==-1,l=!1,s=!1,p=-1,f=br(e.charCodeAt(0))&&!E(e.charCodeAt(e.length-1)),d,h;if(t)for(h=0;h<e.length;h++){if(d=e.charCodeAt(h),!se(d))return G;f=f&&Ee(d)}else{for(h=0;h<e.length;h++){if(d=e.charCodeAt(h),d===10)l=!0,a&&(s=s||h-p-1>i&&e[p+1]!==" ",p=h);else if(!se(d))return G;f=f&&Ee(d)}s=s||a&&h-p-1>i&&e[p+1]!==" "}return!l&&!s?f&&!r.some(c=>c.resolve(e))?yt:o==="'"?xt:G:n>9&&St(e)?G:s?wt:bt}function dt(e,t){if(e===""||e[0]===" ")return e;let n=/ [^ ]/g,i=0,r,o=0,a=0,l=[];for(let s of e.matchAll(n))a=s.index,a-i>t&&(r=o>i?o:a,l.push(e.slice(i,r)),i=r+1),o=a;return e.length-i>t&&o>i?(l.push(e.slice(i,o)),l.push(e.slice(o+1))):l.push(e.slice(i)),l.join(`
`)}function ht(e){return e.at(-1)===`
`?e.slice(0,-1):e}function Sr(e,t){let n=/(\n+)([^\n]*)/g,i=(()=>{let l=e.indexOf(`
`);return l=l!==-1?l:e.length,n.lastIndex=l,dt(e.slice(0,l),t)})(),r=e[0]===`
`||e[0]===" ",o,a;for(;a=n.exec(e);){let l=a[1],s=a[2]||"";o=s[0]===" ",i+=l+(!r&&!o&&s!==""?`
`:"")+dt(s,t),r=o}return i}function kr(e){let t="",n,i,r;for(let o=0;o<e.length;o++){if(n=e.charCodeAt(o),n>=55296&&n<=56319&&(i=e.charCodeAt(o+1),i>=56320&&i<=57343)){t+=ct((n-55296)*1024+i-56320+65536),o++;continue}r=gr.get(n),t+=!r&&se(n)?e[o]:r||ct(n)}return t}function mt(e,t){let n=St(e)?String(t):"",i=e[e.length-1]===`
`,o=i&&(e[e.length-2]===`
`||e===`
`)?"+":i?"":"-";return`${n}${o}
`}function kt(e,t,n){if(!B(e))return;if(t.has(e)){n.add(e);return}t.add(e);let i=Array.isArray(e)?e:Object.values(e);for(let r of i)kt(r,t,n)}var ae=class{indent;arrayIndent;skipInvalid;flowLevel;sortKeys;lineWidth;useAnchors;compatMode;condenseFlow;implicitTypes;explicitTypes;duplicates=[];usedDuplicates=new Set;styleMap=new Map;quoteStyle;constructor({schema:t=N,indent:n=2,arrayIndent:i=!0,skipInvalid:r=!1,flowLevel:o=-1,styles:a=void 0,sortKeys:l=!1,lineWidth:s=80,useAnchors:p=!0,compatMode:f=!0,condenseFlow:d=!1,quoteStyle:h="'"}){this.indent=Math.max(1,n),this.arrayIndent=i,this.skipInvalid=r,this.flowLevel=o,a&&(this.styleMap=xr(a)),this.sortKeys=l,this.lineWidth=s,this.useAnchors=p,this.compatMode=f,this.condenseFlow=d,this.implicitTypes=t.implicitTypes,this.explicitTypes=t.explicitTypes,this.quoteStyle=h}stringifyScalar(t,{level:n,isKey:i}){if(t.length===0)return"''";if(this.compatMode&&yr.includes(t))return`'${t}'`;let r=this.indent*Math.max(1,n),o=this.lineWidth===-1?-1:Math.max(Math.min(this.lineWidth,40),this.lineWidth-r),a=i||this.flowLevel>-1&&n>=this.flowLevel;switch(wr(t,a,this.indent,o,this.implicitTypes,this.quoteStyle)){case yt:return t;case xt:return`'${t.replace(/'/g,"''")}'`;case bt:return`|${mt(t,this.indent)}${ht(pt(t,r))}`;case wt:return`>${mt(t,this.indent)}${ht(pt(Sr(t,o),r))}`;case G:return`"${kr(t)}"`;default:throw new TypeError("Invalid scalar style should be unreachable: please file a bug report against Deno at https://github.com/denoland/std/issues")}}stringifyFlowSequence(t,{level:n}){let i=[];for(let o of t){let a=this.stringifyNode(o,{level:n,block:!1,compact:!1,isKey:!1});a!==null&&i.push(a)}let r=this.condenseFlow?",":", ";return`[${i.join(r)}]`}stringifyBlockSequence(t,{level:n,compact:i}){let r=ft(this.indent,n),o=i?"":r,a=[];for(let l of t){let s=this.stringifyNode(l,{level:n+1,block:!0,compact:!0,isKey:!1});if(s===null)continue;let p=10===s.charCodeAt(0)?"-":"- ";a.push(`${p}${s}`)}return a.length?o+a.join(r):"[]"}stringifyFlowMapping(t,{level:n}){let i=this.condenseFlow?'"':"",r=this.condenseFlow?":":": ",o=[];for(let[a,l]of Object.entries(t)){let s=this.stringifyNode(a,{level:n,block:!1,compact:!1,isKey:!1});if(s===null)continue;let p=this.stringifyNode(l,{level:n,block:!1,compact:!1,isKey:!1});if(p===null)continue;let f=s.length>1024?"? ":"";o.push(i+f+s+i+r+p)}return`{${o.join(", ")}}`}stringifyBlockMapping(t,{tag:n,level:i,compact:r}){let o=Object.keys(t);if(this.sortKeys===!0)o.sort();else if(typeof this.sortKeys=="function")o.sort(this.sortKeys);else if(this.sortKeys)throw new TypeError(`"sortKeys" must be a boolean or a function: received ${typeof this.sortKeys}`);let a=ft(this.indent,i),l=[];for(let p of o){let f=t[p],d=this.stringifyNode(p,{level:i+1,block:!0,compact:!0,isKey:!0});if(d===null)continue;let h=n!==null&&n!=="?"||d.length>1024,c=this.stringifyNode(f,{level:i+1,block:!0,compact:h,isKey:!1});if(c===null)continue;let m="";h&&(m+=d.charCodeAt(0)===10?"?":"? "),m+=d,h&&(m+=a),m+=c.charCodeAt(0)===10?":":": ",m+=c,l.push(m)}let s=r?"":a;return l.length?s+l.join(a):"{}"}getTypeRepresentation(t,n){if(!t.represent)return n;let i=this.styleMap.get(t.tag)??t.defaultStyle;if(typeof t.represent=="function")return t.represent(n,i);let r=t.represent[i];if(!r)throw new TypeError(`!<${t.tag}> tag resolver accepts not "${i}" style`);return r(n,i)}detectType(t){for(let n of this.implicitTypes)if(n.predicate?.(t))return t=this.getTypeRepresentation(n,t),{tag:"?",value:t};for(let n of this.explicitTypes)if(n.predicate?.(t))return t=this.getTypeRepresentation(n,t),{tag:n.tag,value:t};return{tag:null,value:t}}stringifyNode(t,{level:n,block:i,compact:r,isKey:o}){let a=this.detectType(t),l=a.tag;if(t=a.value,i&&(i=this.flowLevel<0||this.flowLevel>n),typeof t=="string"||t instanceof String)t=t instanceof String?t.valueOf():t,l!=="?"&&(t=this.stringifyScalar(t,{level:n,isKey:o}));else if(B(t)){let s=this.duplicates.indexOf(t),p=s!==-1;if(p){if(this.usedDuplicates.has(t))return`*ref_${s}`;this.usedDuplicates.add(t)}if((l!==null&&l!=="?"||p||this.indent!==2&&n>0)&&(r=!1),Array.isArray(t)){let f=!this.arrayIndent&&n>0?n-1:n;i&&t.length!==0?(t=this.stringifyBlockSequence(t,{level:f,compact:r}),p&&(t=`&ref_${s}${t}`)):(t=this.stringifyFlowSequence(t,{level:f}),p&&(t=`&ref_${s} ${t}`))}else i&&Object.keys(t).length!==0?(t=this.stringifyBlockMapping(t,{tag:l,level:n,compact:r}),p&&(t=`&ref_${s}${t}`)):(t=this.stringifyFlowMapping(t,{level:n}),p&&(t=`&ref_${s} ${t}`))}else{if(this.skipInvalid)return null;throw new TypeError(`Cannot stringify ${typeof t}`)}return l!==null&&l!=="?"&&(t=`!<${l}> ${t}`),t}stringify(t){if(this.useAnchors){let i=new Set,r=new Set;kt(t,i,r),this.duplicates=[...r],this.usedDuplicates=new Set}let n=this.stringifyNode(t,{level:0,block:!0,compact:!0,isKey:!1});return n!==null?`${n}
`:""}};function ve(e,t={}){return new ae({...t,schema:z.get(t.schema)}).stringify(e)}var Tt="spools.yaml",Et="jobs.yaml";async function vt(e){let t=await C(),n=`<div class='silverspooler spools'>
  <table>
  <thead>
    <tr>
      <td>Brand</td>
      <td>Material</td>
      <td>Color</td>
      <td style='text-align: right;'>Left</td>
      <td style='text-align: right;'>Initial</td>
      <td style='text-align: right;'>Gross</td>
      <td>Notes</td>
      <td style='text-align: center;'></td>
    </tr>
  </thead>
  <tbody>`;n+=`<tr class='newspool'>
    <td><input type='text' required id='spoolbrand' placeholder='New Brand' style='width: 100%;' /></td>
    <td><input type='text' required id='spoolmaterial' placeholder='New Material' style='width: 100%;' /></td>
    <td><input type='color' required id='spoolcolor' /><input type='checkbox' id='spooltranslucent' /> <label for='spooltranslucent' title='Translucent or transparent filament'>TL</label></td>
    <td style='text-align: right;'>&mdash;</td>
    <td style='text-align: right;'><input type='number' required id='spoolnetweight' style='width: 60%; text-align: right;' value='1000' /></td>
    <td style='text-align: right;'><input type='number' required id='spoolgrossweight' style='width: 60%; text-align: right;' /></td>
    <td><input type='text' id='spoolnotes' style='width: 100%;' /></td>
    <td>
      <button class="sb-button-primary" data-item="newspool" onclick='javascript:document.getElementById("newspooldata").value ="br="+encodeURIComponent(document.getElementById("spoolbrand").value)+"&mt="+encodeURIComponent(document.getElementById("spoolmaterial").value)+"&cl="+encodeURIComponent(document.getElementById("spoolcolor").value)+"&tl="+encodeURIComponent(document.getElementById("spooltranslucent").checked)+"&nw="+encodeURIComponent(document.getElementById("spoolnetweight").value)+"&gw="+encodeURIComponent(document.getElementById("spoolgrossweight").value)+"&nt="+encodeURIComponent(document.getElementById("spoolnotes").value);'>Add</button>
      <input type='hidden' id='newspooldata' value='test-data' />
    </td></tr>`;let i=0,r=0,o=0,a=0;return t.forEach(l=>{if(!e||e&&!l.isRetired){n+=`<tr class='${l.isRetired?"retired":"active"}'>
      <td>${l.brand}</td>
      <td>${l.material}</td>
      <td>${Ct(l.color,l.isTranslucent)}</td>`;let s=`<td style='font-size: 0.8em;'>${l.notes?l.notes:""} <button class='sb-button' data-item="spoolnote|${l.id}" style="margin-left: 8px;">Edit</button></td>`;l.isRetired?n+=`<td style='text-align: right;' class='remaining'>&mdash;</td><td style='text-align: right;'>&mdash;</td><td style='text-align: right;'>&mdash;</td>${s}<td></td>`:(n+=`
        <td style='text-align: right;' class="left">${l.remainingWeight}</td>
        <td style='text-align: right;' class="net"><button class="sb-button" data-item="spoolremaining|${l.id}" title="Modify the initial weight" style="font-size: 0.72em; margin-right: 8px;">Edit</button> ${l.initialNetWeight}</td>
        <td style='text-align: right;' class="gross">${l.grossWeight}</td>
        ${s}`,n+=`<td><button class='sb-button-primary spoolretire' data-item='retire|${l.id}'>Retire</button></td>`),n+="</tr>",i++,o+=l.initialNetWeight,a+=l.remainingWeight}else r++}),n+="</tbody>",n+=`<tfoot><tr><td colspan='3'>${i} Spools${r>0?" (+"+r+" Retired)":""}</td><td style='text-align: right;'>${a}</td><td style='text-align: right;'>${o}</td><td style='text-align: right;'></td><td></td><td></td></tr></tfoot>`,n+="</table></div>",n}async function At(e){let t=await ue();t.sort((s,p)=>p.date.localeCompare(s.date));let n=await C(),i=`<div class='silverspooler printjobs'>
  <table>
  <thead>
    <tr>
      <td style='text-align: right;'>Date</td>
      <td>Description</td>
      <td colspan='3'>Spool</td>
      <td style='text-align: right;'>Weight</td>
      <td style='text-align: right;'>Duration</td>
      <td>Notes</td>
      <td></td>
    </tr>
  </thead>
  <tbody>`,r="";for(let s of n)(!s.isRetired||s.isRetired&&!e)&&(r+=`<option value='${s.id}'>${s.brand} | ${s.material} | ${Mt(s.color,s.isTranslucent)}${s.isRetired?" (Retired)":""}</value>`);i+=`<tr class='newprintjob'>
    <td><input type='date' required id='printjobdate' style='width: 100%;' value="${typeof b<"u"?b?.date:""}" /></td>
    <td><input type='text' required id='printjobdesc' placeholder='Job Description' style='width: 100%;' value="${typeof b<"u"?b?.description:""}" /></td>
    <td colspan='3'><select id='printjobfilament' value="${typeof b<"u"?b?.spoolId:""}">${r}</select></td>
    <td style='text-align: right;'><input type='number' required id='printjobweight' style='width: 60%; text-align: right;' value="${typeof b<"u"?b?.filamentWeight:""}" /></td>
    <td style='text-align: right;'><input type='number' required id='printjobduration' style='width: 60%; text-align: right;' value="${typeof b<"u"?b?.duration:""}" /></td>
    <td><input type='text' id='printjobnotes' style='width: 100%;' value="${typeof b<"u"?b?.notes:""}" /></td>
    <td>
      <button class="sb-button-primary" data-item="newprintjob" onclick='javascript:document.getElementById("newprintjobdata").value ="dt="+encodeURIComponent(document.getElementById("printjobdate").value)+"&ds="+encodeURIComponent(document.getElementById("printjobdesc").value)+"&fl="+encodeURIComponent(document.getElementById("printjobfilament").value)+"&wg="+encodeURIComponent(document.getElementById("printjobweight").value)+"&dr="+encodeURIComponent(document.getElementById("printjobduration").value)+"&nt="+encodeURIComponent(document.getElementById("printjobnotes").value);'>Add</button>
      <input type='hidden' id='newprintjobdata' value='test-data' />
    </td></tr>`;let o=0,a=0,l=0;return t.forEach(s=>{i+=`<tr>
    <td style='text-align: right;'>${new Date(s.date).toLocaleDateString()}</td>
    <td>${s.description}</td>
    <td>${s.spoolBrand}</td>
    <td>${s.spoolMaterial}</td>
    <td>${Ct(s.spoolColor,s.spoolIsTranslucent)}</td>
    <td style='text-align: right;'>${s.filamentWeight}</td>
    <td style='text-align: right;'>${Pt(s.duration)}</td>
    <td style='font-size: 0.8em;'>${s.notes?s.notes:""}</td>`,s.spoolIsRetired&&e?i+="<td></td>":i+=`<td><button class='sb-button-primary' onclick='javascript:document.getElementById("printjobdate").value="${s.date.substring(0,10)}";document.getElementById("printjobdesc").value="${s.description}";document.getElementById("printjobfilament").value="${s.spoolId}";document.getElementById("printjobweight").value="${s.filamentWeight}";document.getElementById("printjobduration").value="${s.duration}";document.getElementById("printjobnotes").value="${s.notes?s.notes:""}";this.parentElement.parentElement.remove();' data-item="deletejob|${s.id}">Del &amp; Redo</button></td>`,o++,a+=s.filamentWeight,l+=s.duration,i+="</tr>"}),i+="</tbody><tfoot>",i+=`<tr><td colspan='5'>${o} Print Jobs</td><td style='text-align: right;'>${a}</td><td style='text-align: right;'>${Pt(l)}</td><td></td><td></td></tr>`,i+="</tfoot></table></div>",i}function Ct(e,t){let n=e+(t?"55":"FF"),i="";return t?i=`<span title='${e}/TL'><span style="background-color: ${e}; color: ${e};">&nbsp;&bull;&bull;&bull;&nbsp;</span><span style="background-color: ${n};">&nbsp;<span style="color: white;">&bull;</span><span style='color: lightgrey;'>&bull;</span><span style="color: black;">&bull;</span>&nbsp;</span></span>`:i=`<span title='${e}'><span style="background-color: ${e}; color: ${e};">&nbsp;&bull;&bull;&bull;&nbsp;</span><span style="background-color: ${e}; color: ${e};">&nbsp;&bull;&bull;&bull;&nbsp;</span></span>`,i+" <span style='font-size: 0.8em;'>"+Mt(e,t)+"</span>"}function Mt(e,t){return e+(t?"/TL":"")}async function It(e,t){S(e)&&(e.startsWith("retire|")?await Pr(e.substring(7)):e=="newspool"?await Tr(t):e.startsWith("deletejob|")?await Er(e.substring(10)):e=="newprintjob"?await vr(t):e.startsWith("spoolnote|")?await Ar(e.substring(10)):e.startsWith("spoolremaining|")?await Cr(e.substring(15)):P("Invalid click data."))}async function Lt(){Q=null,k=null,A=null,b=void 0,await R("SilverSpooler data refreshed.")}async function R(e){await X.refreshAll(),await g.flashNotification(e)}async function Pr(e){if(await g.confirm("Are you sure you want to retire that spool?")){let n=await C();for(let i of n)if(i.id==e){i.isRetired=!0,await le(n),await R("Spool retired.");break}}}async function Tr(e){if(!S(e)){P("No valid arguments.");return}let t=e.split("&"),n="",i="",r="",o=!1,a=0,l=0,s="";for(let h of t){let c=h.split("=");c[1]=Ae(decodeURIComponent(c[1])),c[0]=="br"?n=c[1]:c[0]=="mt"?i=c[1]:c[0]=="cl"?r=c[1].toUpperCase():c[0]=="tl"?(c[1]=c[1].toLowerCase(),o=c[1]==="true"||c[1]==="1"||c[1]==="on"):c[0]=="nw"?a=Number(c[1]):c[0]=="gw"?l=Number(c[1]):c[0]=="nt"&&(s=c[1])}if(!S(n)){g.flashNotification("Please specify spool brand.");return}if(!S(i)){g.flashNotification("Please specify spool material.");return}if(!S(r)){g.flashNotification("Please specify spool color.");return}if(a<=0||a>1e4){g.flashNotification("Please specify an initial spool weight between 1 and 10000.");return}if(l<=0||l>1e4){g.flashNotification("Please specify a gross spool weight between 1 and 10000.");return}if(l<=a){g.flashNotification("Please specify a spool gross weight larger than Net Weight.");return}if(!await g.confirm("Are you sure you want to add that new spool?"))return;let f={id:Ot(),brand:n,material:i,color:r,isTranslucent:o,initialNetWeight:a,grossWeight:l,isRetired:!1,notes:s,remainingWeight:a},d=await C();d.push(f),await le(d),await R("New spool saved.")}async function Er(e){let t=await ue();b=t.find(i=>i.id===e);let n=t.filter(i=>i.id!==e);n.length<t.length&&(await Rt(n),await R("Print job deleted."))}async function vr(e){if(!S(e)){P("No valid arguments.");return}let t=e.split("&"),n="",i="",r="",o=0,a=0,l="";for(let h of t){let c=h.split("=");c[1]=Ae(decodeURIComponent(c[1])),c[0]=="dt"?n=c[1]:c[0]=="ds"?i=c[1]:c[0]=="fl"?r=c[1]:c[0]=="wg"?o=Number(c[1]):c[0]=="dr"?a=Number(c[1]):c[0]=="nt"&&(l=c[1])}let s=(await C()).find(h=>h.id===r);if(!/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(n)){g.flashNotification("Please specify a valid print job date.");return}if(typeof s>"u"){g.flashNotification("Please specify a valid filament spool.");return}if(o<=0||o>1e4){g.flashNotification("Please specify a print job weight between 1 and 10000.");return}if(a<=0||a>1e3){g.flashNotification("Please specify a print job duration between 1 and 1000.");return}if(!await g.confirm("Are you sure you want to add that new print job?"))return;let f={id:Ot(),spoolId:r,date:n,description:i,filamentWeight:o,duration:a,notes:l,spoolBrand:s.brand,spoolMaterial:s.material,spoolColor:s.color,spoolIsTranslucent:s.isTranslucent,spoolIsRetired:s.isRetired},d=await ue();d.push(f),await Rt(d),b=void 0,await R("New print job saved.")}async function Ar(e){let t=await C(),n=t.find(r=>r.id===e);if(typeof n>"u"){P("Spool not found.");return}let i=Ae(await g.prompt("Spool notes:",n.notes));i!==n.notes&&(n.notes=i,await le(t),await R("Spool notes saved."))}async function Cr(e){let t=await C(),n=t.find(o=>o.id===e);if(typeof n>"u"){P("Spool not found.");return}let i=await g.prompt("Modify initial spool weight:",n.initialNetWeight.toString());if(typeof i>"u")return;let r=Number(i);if(isNaN(r)||r<=0||r>1e4){g.flashNotification("Please specify an initial spool weight between 1 and 10000.");return}r!==n.initialNetWeight&&(n.initialNetWeight=r,await le(t),await R("Initial spool weight saved."))}var k;async function C(){if(k==null){let e=await ce(Tt);P("Loading spools from "+e);let t="";for(let n of await T.listDocuments())n.name===e&&(t=Nt(await T.readDocument(e)));S(t)?(k=await Te(t).spools,await Mr(k)):k=new Array,P("Loaded spools: "+k.length)}return k}async function le(e){k=e;let t=new Array;for(let i of e)t.push({id:i.id,brand:i.brand,material:i.material,color:i.color,isTranslucent:i.isTranslucent,grossWeight:i.grossWeight,initialNetWeight:i.initialNetWeight,isRetired:i.isRetired,notes:S(i.notes)?i.notes:""});let n=await ve({spools:t});await T.writeDocument(await ce(Tt),_t(n))}var b,A;async function ue(){if(A==null){let e=await ce(Et);P("Loading jobs from "+e);let t="";for(let n of await T.listDocuments())n.name===e&&(t=Nt(await T.readDocument(e)));S(t)?(A=await Te(t).jobs,await Ir(A)):A=new Array,P("Loaded jobs: "+A.length)}return A}async function Mr(e){let t=await ue();e.forEach(n=>{(n.remainingWeight===void 0||n.remainingWeight===null)&&(n.remainingWeight=n.initialNetWeight),t.forEach(i=>{i.spoolId===n.id&&(n.remainingWeight-=i.filamentWeight)})})}async function Ir(e){let t=await C();e.forEach(n=>{n.spoolBrand="",n.spoolMaterial="",n.spoolColor="",t.forEach(i=>{i.id===n.spoolId&&(n.spoolBrand=i.brand,n.spoolMaterial=i.material,n.spoolColor=i.color,n.spoolIsTranslucent=i.isTranslucent,n.spoolIsRetired=i.isRetired)})})}async function Rt(e){A=e;let t=new Array;for(let i of e)t.push({id:i.id,spoolId:i.spoolId,date:i.date,description:i.description,filamentWeight:i.filamentWeight,duration:i.duration,notes:S(i.notes)?i.notes:""});let n=await ve({jobs:t});await T.writeDocument(await ce(Et),_t(n)),k=null}function Pt(e){let t=Math.floor(e/60),n=e%60;if(t>0){let i=n<10?`0${n}`:`${n}`;return`${t}h ${i}m`}else return`${n}m`}async function ce(e){return(await Lr()).pathPrefix+e}var Q;async function Lr(){if(Q==null){P("Reading settings");let e=await V.getConfig("silverSpooler",{});S(e.pathPrefix)||(e.pathPrefix="Files/SilverSpooler/"),Q=e}return Q}function Nt(e,t="utf-8"){return new TextDecoder(t).decode(e)}function _t(e){return new TextEncoder().encode(e)}function S(e){return typeof e=="string"&&e.length>0}function Ae(e){let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},n=/[&<>"'/]/ig;return e.replace(n,i=>t[i])}function Ot(){return crypto.randomUUID().replace(/[{}()-]/g,"")}function P(e){console.log("SilverSpooler: "+e)}var Ft={renderSpools:vt,renderPrintJobs:At,click:It,refresh:Lt},Dt={name:"silverspooler",functions:{renderSpools:{path:"silverspooler.ts:renderSpools"},renderPrintJobs:{path:"silverspooler.ts:renderPrintJobs"},click:{path:"silverspooler.ts:click"},refresh:{path:"silverspooler.ts:refresh",command:{name:"SilverSpooler: Refresh"}}},assets:{}},ms={manifest:Dt,functionMapping:Ft};Me(Ft,Dt,self.postMessage);export{ms as plug};
