var Lt=Object.defineProperty;var G=(e,t)=>{for(var n in t)Lt(e,n,{get:t[n],enumerable:!0})};function Te(e){let t=atob(e),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.charCodeAt(i);return r}function se(e){typeof e=="string"&&(e=new TextEncoder().encode(e));let t="",n=e.byteLength;for(let r=0;r<n;r++)t+=String.fromCharCode(e[r]);return btoa(t)}var F=e=>{throw new Error("Not initialized yet")},ce=typeof window>"u"&&typeof globalThis.WebSocketPair>"u";typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var le=new Map,ae=0;ce&&(globalThis.syscall=async(e,...t)=>await new Promise((n,r)=>{ae++,le.set(ae,{resolve:n,reject:r}),F({type:"sys",id:ae,name:e,args:t})}));function Pe(e,t,n){ce&&(F=n,self.addEventListener("message",r=>{(async()=>{let i=r.data;switch(i.type){case"inv":{let o=e[i.name];if(!o)throw new Error(`Function not loaded: ${i.name}`);try{let s=await Promise.resolve(o(...i.args||[]));F({type:"invr",id:i.id,result:s})}catch(s){console.error("An exception was thrown as a result of invoking function",i.name,"error:",s.message),F({type:"invr",id:i.id,error:s.message})}}break;case"sysr":{let o=i.id,s=le.get(o);if(!s)throw Error("Invalid request id");le.delete(o),i.error?s.reject(new Error(i.error)):s.resolve(i.result)}break}})().catch(console.error)}),F({type:"manifest",manifest:t}))}async function Nt(e,t){if(typeof e!="string"){let n=new Uint8Array(await e.arrayBuffer()),r=n.length>0?se(n):void 0;t={method:e.method,headers:Object.fromEntries(e.headers.entries()),base64Body:r},e=e.url}return syscall("sandboxFetch.fetch",e,t)}globalThis.nativeFetch=globalThis.fetch;function Rt(){globalThis.fetch=async function(e,t){let n=t&&t.body?se(new Uint8Array(await new Response(t.body).arrayBuffer())):void 0,r=await Nt(e,t&&{method:t.method,headers:t.headers,base64Body:n});return new Response(r.base64Body?Te(r.base64Body):null,{status:r.status,headers:r.headers})}}ce&&Rt();var b={};G(b,{alert:()=>yn,configureVimMode:()=>In,confirm:()=>gn,copyToClipboard:()=>vn,deleteLine:()=>Mn,dispatch:()=>dn,downloadFile:()=>tn,filterBox:()=>on,flashNotification:()=>rn,fold:()=>wn,foldAll:()=>Tn,getCurrentEditor:()=>Dt,getCurrentPage:()=>It,getCurrentPageMeta:()=>_t,getCurrentPath:()=>Ot,getCursor:()=>$t,getRecentlyOpenedPages:()=>Ft,getSelection:()=>Kt,getText:()=>Ut,getUiOption:()=>xn,goHistory:()=>en,hidePanel:()=>an,insertAtCursor:()=>hn,insertAtPos:()=>cn,invokeCommand:()=>qt,moveCursor:()=>pn,moveCursorToLine:()=>fn,moveLineDown:()=>Nn,moveLineUp:()=>Ln,navigate:()=>Ht,newWindow:()=>Zt,openCommandPalette:()=>Qt,openPageNavigator:()=>Gt,openSearchPanel:()=>Cn,openUrl:()=>zt,prompt:()=>mn,rebuildEditorState:()=>Jt,redo:()=>An,reloadConfigAndCommands:()=>Xt,reloadPage:()=>Vt,reloadUI:()=>jt,replaceRange:()=>un,save:()=>Yt,sendMessage:()=>_n,setSelection:()=>Wt,setText:()=>Bt,setUiOption:()=>bn,showPanel:()=>sn,showProgress:()=>ln,toggleFold:()=>kn,undo:()=>En,unfold:()=>Sn,unfoldAll:()=>Pn,uploadFile:()=>nn,vimEx:()=>Rn});typeof self>"u"&&(self={syscall:()=>{throw new Error("Not implemented here")}});function a(e,...t){return globalThis.syscall(e,...t)}function It(){return a("editor.getCurrentPage")}function _t(){return a("editor.getCurrentPageMeta")}function Ot(e=!1){return a("editor.getCurrentPath",e)}function Ft(){return a("editor.getRecentlyOpenedPages")}function Dt(){return a("editor.getCurrentEditor")}function Ut(){return a("editor.getText")}function Bt(e,t=!1){return a("editor.setText",e,t)}function $t(){return a("editor.getCursor")}function Kt(){return a("editor.getSelection")}function Wt(e,t){return a("editor.setSelection",e,t)}function qt(e,t){return a("editor.invokeCommand",e,t)}function Yt(){return a("editor.save")}function Ht(e,t=!1,n=!1){return a("editor.navigate",e,t,n)}function Gt(e="page"){return a("editor.openPageNavigator",e)}function Qt(){return a("editor.openCommandPalette")}function Vt(){return a("editor.reloadPage")}function jt(){return a("editor.reloadUI")}function Jt(){return a("editor.rebuildEditorState")}function Xt(){return a("editor.reloadConfigAndCommands")}function zt(e,t=!1){return a("editor.openUrl",e,t)}function Zt(){return a("editor.newWindow")}function en(e){return a("editor.goHistory",e)}function tn(e,t){return a("editor.downloadFile",e,t)}function nn(e,t){return a("editor.uploadFile",e,t)}function rn(e,t="info"){return a("editor.flashNotification",e,t)}function on(e,t,n="",r=""){return a("editor.filterBox",e,t,n,r)}function sn(e,t,n,r=""){return a("editor.showPanel",e,t,n,r)}function an(e){return a("editor.hidePanel",e)}function ln(e,t){return a("editor.showProgress",e,t)}function cn(e,t){return a("editor.insertAtPos",e,t)}function un(e,t,n){return a("editor.replaceRange",e,t,n)}function pn(e,t=!1){return a("editor.moveCursor",e,t)}function fn(e,t=1,n=!1){return a("editor.moveCursorToLine",e,t,n)}function hn(e,t=!1,n=!1){return a("editor.insertAtCursor",e,t,n)}function dn(e){return a("editor.dispatch",e)}function mn(e,t=""){return a("editor.prompt",e,t)}function gn(e){return a("editor.confirm",e)}function yn(e){return a("editor.alert",e)}function xn(e){return a("editor.getUiOption",e)}function bn(e,t){return a("editor.setUiOption",e,t)}function wn(){return a("editor.fold")}function Sn(){return a("editor.unfold")}function kn(){return a("editor.toggleFold")}function Tn(){return a("editor.foldAll")}function Pn(){return a("editor.unfoldAll")}function En(){return a("editor.undo")}function An(){return a("editor.redo")}function Cn(){return a("editor.openSearchPanel")}function vn(e){return a("editor.copyToClipboard",e)}function Mn(){return a("editor.deleteLine")}function Ln(){return a("editor.moveLineUp")}function Nn(){return a("editor.moveLineDown")}function Rn(e){return a("editor.vimEx",e)}function In(){return a("editor.configureVimMode")}function _n(e,t){return a("editor.sendMessage",e,t)}var M={};G(M,{deleteDocument:()=>Qn,deleteFile:()=>zn,deletePage:()=>Kn,fileExists:()=>Zn,getDocumentMeta:()=>Yn,getFileMeta:()=>Jn,getPageMeta:()=>Dn,listDocuments:()=>qn,listFiles:()=>Vn,listPages:()=>Fn,listPlugs:()=>Wn,pageExists:()=>Un,readDocument:()=>Hn,readFile:()=>jn,readPage:()=>Bn,writeDocument:()=>Gn,writeFile:()=>Xn,writePage:()=>$n});function Fn(){return a("space.listPages")}function Dn(e){return a("space.getPageMeta",e)}function Un(e){return a("space.pageExists",e)}function Bn(e){return a("space.readPage",e)}function $n(e,t){return a("space.writePage",e,t)}function Kn(e){return a("space.deletePage",e)}function Wn(){return a("space.listPlugs")}function qn(){return a("space.listDocuments")}function Yn(e){return a("space.getDocumentMeta",e)}function Hn(e){return a("space.readDocument",e)}function Gn(e,t){return a("space.writeDocument",e,t)}function Qn(e){return a("space.deleteDocument",e)}function Vn(){return a("space.listFiles")}function jn(e){return a("space.readFile",e)}function Jn(e){return a("space.getFileMeta",e)}function Xn(e,t){return a("space.writeFile",e,t)}function zn(e){return a("space.deleteFile",e)}function Zn(e){return a("space.fileExists",e)}var Q={};G(Q,{getConfig:()=>ar,getMode:()=>or,getVersion:()=>sr,invokeCommand:()=>tr,invokeFunction:()=>er,listCommands:()=>nr,listSyscalls:()=>rr,reloadPlugs:()=>ir,wipeClient:()=>lr});function er(e,...t){return a("system.invokeFunction",e,...t)}function tr(e,t){return a("system.invokeCommand",e,t)}function nr(){return a("system.listCommands")}function rr(){return a("system.listSyscalls")}function ir(){return a("system.reloadPlugs")}function or(){return a("system.getMode")}function sr(){return a("system.getVersion")}function ar(e,t=void 0){return a("system.getConfig",e,t)}function lr(e=!1){return a("system.wipeClient",e)}var V={};G(V,{refreshAll:()=>fr});function fr(){return a("codeWidget.refreshAll")}function x(e){return e===10||e===13}function w(e){return e===9||e===32}function y(e){return w(e)||x(e)}function E(e){return e===44||e===91||e===93||e===123||e===125}var ue=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function kr(e){if(e===null)return!1;let t,n=0,r=e.length,i=ue;for(let o=0;o<r;o++)if(t=i.indexOf(e.charAt(o)),!(t>64)){if(t<0)return!1;n+=6}return n%8===0}function Tr(e){let t=e.replace(/[\r\n=]/g,""),n=t.length,r=ue,i=[],o=0;for(let c=0;c<n;c++)c%4===0&&c&&(i.push(o>>16&255),i.push(o>>8&255),i.push(o&255)),o=o<<6|r.indexOf(t.charAt(c));let s=n%4*6;return s===0?(i.push(o>>16&255),i.push(o>>8&255),i.push(o&255)):s===18?(i.push(o>>10&255),i.push(o>>2&255)):s===12&&i.push(o>>4&255),new Uint8Array(i)}function Pr(e){let t=e.length,n=ue,r="",i=0;for(let s=0;s<t;s++)s%3===0&&s&&(r+=n[i>>18&63],r+=n[i>>12&63],r+=n[i>>6&63],r+=n[i&63]),i=(i<<8)+e[s];let o=t%3;return o===0?(r+=n[i>>18&63],r+=n[i>>12&63],r+=n[i>>6&63],r+=n[i&63]):o===2?(r+=n[i>>10&63],r+=n[i>>4&63],r+=n[i<<2&63],r+=n[64]):o===1&&(r+=n[i>>2&63],r+=n[i<<4&63],r+=n[64],r+=n[64]),r}function Er(e){return e instanceof Uint8Array}var Ee={tag:"tag:yaml.org,2002:binary",construct:Tr,kind:"scalar",predicate:Er,represent:Pr,resolve:kr};var Ae=["true","True","TRUE"],Ar=["false","False","FALSE"],Cr=[...Ae,...Ar],Ce={tag:"tag:yaml.org,2002:bool",kind:"scalar",defaultStyle:"lowercase",predicate:e=>typeof e=="boolean"||e instanceof Boolean,construct:e=>Ae.includes(e),resolve:e=>Cr.includes(e),represent:{lowercase:e=>(e instanceof Boolean?e.valueOf():e)?"true":"false",uppercase:e=>(e instanceof Boolean?e.valueOf():e)?"TRUE":"FALSE",camelcase:e=>(e instanceof Boolean?e.valueOf():e)?"True":"False"}};function D(e){return e!==null&&typeof e=="object"}function U(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}function A(e){return Object.prototype.toString.call(e)==="[object Object]"}var vr=new RegExp("^(?:[-+]?(?:0|[1-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function Mr(e){return!(!vr.test(e)||e[e.length-1]==="_")}function Lr(e){let t=e.replace(/_/g,"").toLowerCase(),n=t[0]==="-"?-1:1;return t[0]&&"+-".includes(t[0])&&(t=t.slice(1)),t===".inf"?n===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t===".nan"?NaN:n*parseFloat(t)}var Nr=/^[-+]?[0-9]+e/;function Rr(e,t){let n=e instanceof Number?e.valueOf():e;if(isNaN(n))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===n)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===n)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(U(n))return"-0.0";let r=n.toString(10);return Nr.test(r)?r.replace("e",".e"):r}function Ir(e){return e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&(e%1!==0||U(e))}var ve={tag:"tag:yaml.org,2002:float",construct:Lr,defaultStyle:"lowercase",kind:"scalar",predicate:Ir,represent:Rr,resolve:Mr};function B(e,t,n){return t<=e&&e<=n}function _r(e){return B(e,48,57)||B(e,65,70)||B(e,97,102)}function Or(e){return B(e,48,55)}function Fr(e){return B(e,48,57)}function Dr(e){let t=e.length,n=0,r=!1;if(!t)return!1;let i=e[n];if((i==="-"||i==="+")&&(i=e[++n]),i==="0"){if(n+1===t)return!0;if(i=e[++n],i==="b"){for(n++;n<t;n++)if(i=e[n],i!=="_"){if(i!=="0"&&i!=="1")return!1;r=!0}return r&&i!=="_"}if(i==="x"){for(n++;n<t;n++)if(i=e[n],i!=="_"){if(!_r(e.charCodeAt(n)))return!1;r=!0}return r&&i!=="_"}for(;n<t;n++)if(i=e[n],i!=="_"){if(!Or(e.charCodeAt(n)))return!1;r=!0}return r&&i!=="_"}if(i==="_")return!1;for(;n<t;n++)if(i=e[n],i!=="_"){if(!Fr(e.charCodeAt(n)))return!1;r=!0}return!r||i==="_"?!1:/^(:[0-5]?[0-9])+$/.test(e.slice(n))}function Ur(e){let t=e;t.includes("_")&&(t=t.replace(/_/g,""));let n=1,r=t[0];return(r==="-"||r==="+")&&(r==="-"&&(n=-1),t=t.slice(1),r=t[0]),t==="0"?0:r==="0"?t[1]==="b"?n*parseInt(t.slice(2),2):t[1]==="x"?n*parseInt(t,16):n*parseInt(t,8):n*parseInt(t,10)}function Br(e){return e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&e%1===0&&!U(e)}var Me={tag:"tag:yaml.org,2002:int",construct:Ur,defaultStyle:"decimal",kind:"scalar",predicate:Br,represent:{binary(e){let t=e instanceof Number?e.valueOf():e;return t>=0?`0b${t.toString(2)}`:`-0b${t.toString(2).slice(1)}`},octal(e){let t=e instanceof Number?e.valueOf():e;return t>=0?`0${t.toString(8)}`:`-0${t.toString(8).slice(1)}`},decimal(e){return(e instanceof Number?e.valueOf():e).toString(10)},hexadecimal(e){let t=e instanceof Number?e.valueOf():e;return t>=0?`0x${t.toString(16).toUpperCase()}`:`-0x${t.toString(16).toUpperCase().slice(1)}`}},resolve:Dr};var Le={tag:"tag:yaml.org,2002:map",resolve(){return!0},construct(e){return e!==null?e:{}},kind:"mapping"};var Ne={tag:"tag:yaml.org,2002:merge",kind:"scalar",resolve:e=>e==="<<"||e===null,construct:e=>e};var Re={tag:"tag:yaml.org,2002:null",kind:"scalar",defaultStyle:"lowercase",predicate:e=>e===null,construct:()=>null,resolve:e=>e==="~"||e==="null"||e==="Null"||e==="NULL",represent:{lowercase:()=>"null",uppercase:()=>"NULL",camelcase:()=>"Null"}};function $r(e){let t=new Set;for(let n of e){if(!A(n))return!1;let r=Object.keys(n);if(r.length!==1)return!1;for(let i of r){if(t.has(i))return!1;t.add(i)}}return!0}var Ie={tag:"tag:yaml.org,2002:omap",kind:"sequence",resolve:$r,construct(e){return e}};function Kr(e){return e===null?!0:e.every(t=>A(t)&&Object.keys(t).length===1)}var _e={tag:"tag:yaml.org,2002:pairs",construct(e){return e?.flatMap(Object.entries)??[]},kind:"sequence",resolve:Kr};var Oe=/^\/(?<regexp>[\s\S]+)\/(?<modifiers>[gismuy]*)$/,Fe={tag:"tag:yaml.org,2002:js/regexp",kind:"scalar",resolve(e){if(e===null||!e.length)return!1;if(e.charAt(0)==="/"){let t=e.match(Oe)?.groups;if(!t)return!1;let n=t.modifiers??"";if(new Set(n).size<n.length)return!1}return!0},construct(e){let{regexp:t=e,modifiers:n=""}=e.match(Oe)?.groups??{};return new RegExp(t,n)},predicate:e=>e instanceof RegExp,represent:e=>e.toString()};var De={tag:"tag:yaml.org,2002:seq",kind:"sequence",resolve:()=>!0,construct:e=>e!==null?e:[]};var Ue={tag:"tag:yaml.org,2002:set",kind:"mapping",construct:e=>e!==null?e:{},resolve:e=>e===null?!0:Object.values(e).every(t=>t===null)};var Be={tag:"tag:yaml.org,2002:str",kind:"scalar",resolve:()=>!0,construct:e=>e!==null?e:""};var $e=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Ke=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function Wr(e){return e===null?!1:$e.exec(e)!==null||Ke.exec(e)!==null}function qr(e){let t=$e.exec(e);if(t===null&&(t=Ke.exec(e)),t===null)throw new Error("Cannot construct YAML timestamp: date resolve error");let n=+t[1],r=+t[2]-1,i=+t[3];if(!t[4])return new Date(Date.UTC(n,r,i));let o=+t[4],s=+t[5],c=+t[6],l=0;if(t[7]){let h=t[7].slice(0,3);for(;h.length<3;)h+="0";l=+h}let f=null;if(t[9]&&t[10]){let h=+t[10],u=+(t[11]||0);f=(h*60+u)*6e4,t[9]==="-"&&(f=-f)}let p=new Date(Date.UTC(n,r,i,o,s,c,l));return f&&p.setTime(p.getTime()-f),p}function Yr(e){return e.toISOString()}var We={tag:"tag:yaml.org,2002:timestamp",construct:qr,predicate(e){return e instanceof Date},kind:"scalar",represent:Yr,resolve:Wr};var qe={tag:"tag:yaml.org,2002:js/undefined",kind:"scalar",resolve(){return!0},construct(){},predicate(e){return typeof e>"u"},represent(){return""}};function Hr(e,t){let n={fallback:new Map,mapping:new Map,scalar:new Map,sequence:new Map},r=n.fallback;for(let i of[...e,...t])n[i.kind].set(i.tag,i),r.set(i.tag,i);return n}function $({explicitTypes:e=[],implicitTypes:t=[],include:n}){n&&(t.push(...n.implicitTypes),e.push(...n.explicitTypes));let r=Hr(t,e);return{implicitTypes:t,explicitTypes:e,typeMap:r}}var Ye=$({explicitTypes:[Be,De,Le]}),He=$({implicitTypes:[Re,Ce,Me,ve],include:Ye}),Ge=$({include:He}),L=$({explicitTypes:[Ee,Ie,_e,Ue],implicitTypes:[We,Ne],include:Ge}),Gr=$({explicitTypes:[Fe,qe],include:L}),j=new Map([["core",Ge],["default",L],["failsafe",Ye],["json",He],["extended",Gr]]);var J=1,Je=2,Xe=3,X=4,pe=1,Jr=2,ze=3,Xr=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,zr=/[\x85\u2028\u2029]/,Zr=/[,\[\]\{\}]/,Ze=/^(?:!|!!|![a-z\-]+!)$/i,et=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i,ei=new Map([[120,2],[117,4],[85,8]]),tt=new Map([[48,"\0"],[97,"\x07"],[98,"\b"],[116,"	"],[9,"	"],[110,`
`],[118,"\v"],[102,"\f"],[114,"\r"],[101,"\x1B"],[32," "],[34,'"'],[47,"/"],[92,"\\"],[78,"\x85"],[95,"\xA0"],[76,"\u2028"],[80,"\u2029"]]);function ti(e){if(48<=e&&e<=57)return e-48;let t=e|32;return 97<=t&&t<=102?t-97+10:-1}function ni(e){return 48<=e&&e<=57?e-48:-1}function ri(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var nt=4,rt=75,it=`\0\r
\x85\u2028\u2029`;function ii(e,t){if(!e)return null;let n=t,r=t,i="",o="";for(;n>0&&!it.includes(e.charAt(n-1));)if(n--,t-n>rt/2-1){i=" ... ",n+=5;break}for(;r<e.length&&!it.includes(e.charAt(r));)if(r++,r-t>rt/2-1){o=" ... ",r-=5;break}let s=e.slice(n,r),c=" ".repeat(nt),l=" ".repeat(nt+t-n+i.length);return`${c+i+s+o}
${l}^`}function oi(e,t,n,r){let i=`at line ${n+1}, column ${r+1}`,o=ii(e,t);return o&&(i+=`:
${o}`),i}var ne=class{input;length;lineIndent=0;lineStart=0;position=0;line=0;onWarning;allowDuplicateKeys;implicitTypes;typeMap;version;checkLineBreaks=!1;tagMap=new Map;anchorMap=new Map;tag;anchor;kind;result="";constructor(t,{schema:n=L,onWarning:r,allowDuplicateKeys:i=!1}){this.input=t,this.onWarning=r,this.allowDuplicateKeys=i,this.implicitTypes=n.implicitTypes,this.typeMap=n.typeMap,this.length=t.length,this.version=null,this.readIndent()}skipWhitespaces(){let t=this.peek();for(;w(t);)t=this.next()}skipComment(){let t=this.peek();if(t===35)for(t=this.next();t!==0&&!x(t);)t=this.next()}readIndent(){let t=this.peek();for(;t===32;)this.lineIndent+=1,t=this.next()}peek(t=0){return this.input.charCodeAt(this.position+t)}next(){return this.position+=1,this.peek()}#e(t){let n=oi(this.input,this.position,this.line,this.position-this.lineStart);return new SyntaxError(`${t} ${n}`)}dispatchWarning(t){let n=this.#e(t);this.onWarning?.(n)}yamlDirectiveHandler(...t){if(this.version!==null)throw this.#e("Cannot handle YAML directive: duplication of %YAML directive");if(t.length!==1)throw this.#e("Cannot handle YAML directive: YAML directive accepts exactly one argument");let n=/^([0-9]+)\.([0-9]+)$/.exec(t[0]);if(n===null)throw this.#e("Cannot handle YAML directive: ill-formed argument");let r=parseInt(n[1],10),i=parseInt(n[2],10);if(r!==1)throw this.#e("Cannot handle YAML directive: unacceptable YAML version");if(this.version=t[0]??null,this.checkLineBreaks=i<2,i!==1&&i!==2)return this.dispatchWarning("Cannot handle YAML directive: unsupported YAML version")}tagDirectiveHandler(...t){if(t.length!==2)throw this.#e(`Cannot handle tag directive: directive accepts exactly two arguments, received ${t.length}`);let n=t[0],r=t[1];if(!Ze.test(n))throw this.#e(`Cannot handle tag directive: ill-formed handle (first argument) in "${n}"`);if(this.tagMap.has(n))throw this.#e(`Cannot handle tag directive: previously declared suffix for "${n}" tag handle`);if(!et.test(r))throw this.#e("Cannot handle tag directive: ill-formed tag prefix (second argument) of the TAG directive");this.tagMap.set(n,r)}captureSegment(t,n,r){if(t<n){let i=this.input.slice(t,n);if(r)for(let o=0;o<i.length;o++){let s=i.charCodeAt(o);if(!(s===9||32<=s&&s<=1114111))throw this.#e(`Expected valid JSON character: received "${s}"`)}else if(Xr.test(i))throw this.#e("Stream contains non-printable characters");this.result+=i}}readBlockSequence(t){let n=!1,r=this.tag,i=this.anchor,o=[];this.anchor!==null&&typeof this.anchor<"u"&&this.anchorMap.set(this.anchor,o);let s=this.peek();for(;s!==0&&s===45;){let c=this.peek(1);if(!y(c))break;if(n=!0,this.position++,this.skipSeparationSpace(!0,-1)&&this.lineIndent<=t){o.push(null),s=this.peek();continue}let l=this.line;if(this.composeNode({parentIndent:t,nodeContext:Xe,allowToSeek:!1,allowCompact:!0}),o.push(this.result),this.skipSeparationSpace(!0,-1),s=this.peek(),(this.line===l||this.lineIndent>t)&&s!==0)throw this.#e("Cannot read block sequence: bad indentation of a sequence entry");if(this.lineIndent<t)break}return n?(this.tag=r,this.anchor=i,this.kind="sequence",this.result=o,!0):!1}mergeMappings(t,n,r){if(!D(n))throw this.#e("Cannot merge mappings: the provided source object is unacceptable");for(let[i,o]of Object.entries(n))Object.hasOwn(t,i)||(Object.defineProperty(t,i,{value:o,writable:!0,enumerable:!0,configurable:!0}),r.add(i))}storeMappingPair(t,n,r,i,o,s,c){if(Array.isArray(i)){i=Array.prototype.slice.call(i);for(let l=0;l<i.length;l++){if(Array.isArray(i[l]))throw this.#e("Cannot store mapping pair: nested arrays are not supported inside keys");typeof i=="object"&&A(i[l])&&(i[l]="[object Object]")}}if(typeof i=="object"&&A(i)&&(i="[object Object]"),i=String(i),r==="tag:yaml.org,2002:merge")if(Array.isArray(o))for(let l=0;l<o.length;l++)this.mergeMappings(t,o[l],n);else this.mergeMappings(t,o,n);else{if(!this.allowDuplicateKeys&&!n.has(i)&&Object.hasOwn(t,i))throw this.line=s||this.line,this.position=c||this.position,this.#e("Cannot store mapping pair: duplicated key");Object.defineProperty(t,i,{value:o,writable:!0,enumerable:!0,configurable:!0}),n.delete(i)}return t}readLineBreak(){let t=this.peek();if(t===10)this.position++;else if(t===13)this.position++,this.peek()===10&&this.position++;else throw this.#e("Cannot read line: line break not found");this.line+=1,this.lineStart=this.position}skipSeparationSpace(t,n){let r=0,i=this.peek();for(;i!==0&&(this.skipWhitespaces(),i=this.peek(),t&&(this.skipComment(),i=this.peek()),x(i));)this.readLineBreak(),i=this.peek(),r++,this.lineIndent=0,this.readIndent(),i=this.peek();return n!==-1&&r!==0&&this.lineIndent<n&&this.dispatchWarning("deficient indentation"),r}testDocumentSeparator(){let t=this.peek();return!!((t===45||t===46)&&t===this.peek(1)&&t===this.peek(2)&&(t=this.peek(3),t===0||y(t)))}writeFoldedLines(t){t===1?this.result+=" ":t>1&&(this.result+=`
`.repeat(t-1))}readPlainScalar(t,n){let r=this.kind,i=this.result,o=this.peek();if(y(o)||E(o)||o===35||o===38||o===42||o===33||o===124||o===62||o===39||o===34||o===37||o===64||o===96)return!1;let s;if((o===63||o===45)&&(s=this.peek(1),y(s)||n&&E(s)))return!1;this.kind="scalar",this.result="";let c=this.position,l=this.position,f=!1,p=0;for(;o!==0;){if(o===58){if(s=this.peek(1),y(s)||n&&E(s))break}else if(o===35){let h=this.peek(-1);if(y(h))break}else{if(this.position===this.lineStart&&this.testDocumentSeparator()||n&&E(o))break;if(x(o)){p=this.line;let h=this.lineStart,u=this.lineIndent;if(this.skipSeparationSpace(!1,-1),this.lineIndent>=t){f=!0,o=this.peek();continue}else{this.position=c,this.line=p,this.lineStart=h,this.lineIndent=u;break}}}f&&(this.captureSegment(l,c,!1),this.writeFoldedLines(this.line-p),l=c=this.position,f=!1),w(o)||(c=this.position+1),o=this.next()}return this.captureSegment(l,c,!1),this.result?!0:(this.kind=r,this.result=i,!1)}readSingleQuotedScalar(t){let n=this.peek();if(n!==39)return!1;this.kind="scalar",this.result="",this.position++;let r=this.position,i=this.position;for(n=this.peek();n!==0;){if(n===39)if(this.captureSegment(r,this.position,!0),n=this.next(),n===39)r=this.position,this.position++,i=this.position;else return!0;else if(x(n))this.captureSegment(r,i,!0),this.writeFoldedLines(this.skipSeparationSpace(!1,t)),r=i=this.position;else{if(this.position===this.lineStart&&this.testDocumentSeparator())throw this.#e("Unexpected end of the document within a single quoted scalar");this.position++,i=this.position}n=this.peek()}throw this.#e("Unexpected end of the stream within a single quoted scalar")}readDoubleQuotedScalar(t){let n=this.peek();if(n!==34)return!1;this.kind="scalar",this.result="",this.position++;let r=this.position,i=this.position,o;for(n=this.peek();n!==0;){if(n===34)return this.captureSegment(i,this.position,!0),this.position++,!0;if(n===92){if(this.captureSegment(i,this.position,!0),n=this.next(),x(n))this.skipSeparationSpace(!1,t);else if(n<256&&tt.has(n))this.result+=tt.get(n),this.position++;else if((o=ei.get(n)??0)>0){let s=o,c=0;for(;s>0;s--)if(n=this.next(),(o=ti(n))>=0)c=(c<<4)+o;else throw this.#e("Cannot read double quoted scalar: expected hexadecimal character");this.result+=ri(c),this.position++}else throw this.#e("Cannot read double quoted scalar: unknown escape sequence");i=r=this.position}else if(x(n))this.captureSegment(i,r,!0),this.writeFoldedLines(this.skipSeparationSpace(!1,t)),i=r=this.position;else{if(this.position===this.lineStart&&this.testDocumentSeparator())throw this.#e("Unexpected end of the document within a double quoted scalar");this.position++,r=this.position}n=this.peek()}throw this.#e("Unexpected end of the stream within a double quoted scalar")}readFlowCollection(t){let n=this.peek(),r,i=!0,o={};if(n===91)r=93,i=!1,o=[];else if(n===123)r=125;else return!1;this.anchor!==null&&typeof this.anchor<"u"&&this.anchorMap.set(this.anchor,o),n=this.next();let s=this.tag,c=this.anchor,l=!0,f=null,p=null,h=null,u=!1,d=!1,m=0,g=0,O=new Set;for(;n!==0;){if(this.skipSeparationSpace(!0,t),n=this.peek(),n===r)return this.position++,this.tag=s,this.anchor=c,this.kind=i?"mapping":"sequence",this.result=o,!0;if(!l)throw this.#e("Cannot read flow collection: missing comma between flow collection entries");h=p=f=null,d=u=!1,n===63&&(m=this.peek(1),y(m)&&(d=u=!0,this.position++,this.skipSeparationSpace(!0,t))),g=this.line,this.composeNode({parentIndent:t,nodeContext:J,allowToSeek:!1,allowCompact:!0}),h=this.tag||null,p=this.result,this.skipSeparationSpace(!0,t),n=this.peek(),(u||this.line===g)&&n===58&&(d=!0,n=this.next(),this.skipSeparationSpace(!0,t),this.composeNode({parentIndent:t,nodeContext:J,allowToSeek:!1,allowCompact:!0}),f=this.result),i?this.storeMappingPair(o,O,h,p,f):d?o.push(this.storeMappingPair({},O,h,p,f)):o.push(p),this.skipSeparationSpace(!0,t),n=this.peek(),n===44?(l=!0,n=this.next()):l=!1}throw this.#e("Cannot read flow collection: unexpected end of the stream within a flow collection")}readBlockScalar(t){let n=pe,r=!1,i=!1,o=t,s=0,c=!1,l=this.peek(),f=!1;if(l===124)f=!1;else if(l===62)f=!0;else return!1;this.kind="scalar",this.result="";let p=0;for(;l!==0;)if(l=this.next(),l===43||l===45)if(pe===n)n=l===43?ze:Jr;else throw this.#e("Cannot read block: chomping mode identifier repeated");else if((p=ni(l))>=0){if(p===0)throw this.#e("Cannot read block: indentation width must be greater than 0");if(!i)o=t+p-1,i=!0;else throw this.#e("Cannot read block: indentation width identifier repeated")}else break;for(w(l)&&(this.skipWhitespaces(),this.skipComment(),l=this.peek());l!==0;){for(this.readLineBreak(),this.lineIndent=0,l=this.peek();(!i||this.lineIndent<o)&&l===32;)this.lineIndent++,l=this.next();if(!i&&this.lineIndent>o&&(o=this.lineIndent),x(l)){s++;continue}if(this.lineIndent<o){n===ze?this.result+=`
`.repeat(r?1+s:s):n===pe&&r&&(this.result+=`
`);break}f?w(l)?(c=!0,this.result+=`
`.repeat(r?1+s:s)):c?(c=!1,this.result+=`
`.repeat(s+1)):s===0?r&&(this.result+=" "):this.result+=`
`.repeat(s):this.result+=`
`.repeat(r?1+s:s),r=!0,i=!0,s=0;let h=this.position;for(;!x(l)&&l!==0;)l=this.next();this.captureSegment(h,this.position,!1)}return!0}readBlockMapping(t,n){let r=this.tag,i=this.anchor,o={},s=new Set,c=!1,l,f,p=null,h=null,u=null,d=!1,m=!1;this.anchor!==null&&typeof this.anchor<"u"&&this.anchorMap.set(this.anchor,o);let g=this.peek();for(;g!==0;){let O=this.peek(1);if(l=this.line,f=this.position,(g===63||g===58)&&y(O)){if(g===63)d&&(this.storeMappingPair(o,s,p,h,null),p=null,h=null,u=null),m=!0,d=!0,c=!0;else if(d)d=!1,c=!0;else throw this.#e("Cannot read block as explicit mapping pair is incomplete: a key node is missed or followed by a non-tabulated empty line");this.position+=1,g=O}else if(this.composeNode({parentIndent:n,nodeContext:Je,allowToSeek:!1,allowCompact:!0}))if(this.line===l)if(g=this.peek(),this.skipWhitespaces(),g=this.peek(),g===58){if(g=this.next(),!y(g))throw this.#e("Cannot read block: a whitespace character is expected after the key-value separator within a block mapping");d&&(this.storeMappingPair(o,s,p,h,null),p=null,h=null,u=null),m=!0,d=!1,c=!1,p=this.tag,h=this.result}else{if(m)throw this.#e("Cannot read an implicit mapping pair: missing colon");return this.tag=r,this.anchor=i,!0}else{if(m)throw this.#e("Cannot read a block mapping entry: a multiline key may not be an implicit key");return this.tag=r,this.anchor=i,!0}else break;if((this.line===l||this.lineIndent>t)&&(this.composeNode({parentIndent:t,nodeContext:X,allowToSeek:!0,allowCompact:c})&&(d?h=this.result:u=this.result),d||(this.storeMappingPair(o,s,p,h,u,l,f),p=h=u=null),this.skipSeparationSpace(!0,-1),g=this.peek()),this.lineIndent>t&&g!==0)throw this.#e("Cannot read block: bad indentation of a mapping entry");if(this.lineIndent<t)break}return d&&this.storeMappingPair(o,s,p,h,null),m&&(this.tag=r,this.anchor=i,this.kind="mapping",this.result=o),m}readTagProperty(){let t=!1,n=!1,r="",i,o=this.peek();if(o!==33)return!1;if(this.tag!==null)throw this.#e("Cannot read tag property: duplication of a tag property");o=this.next(),o===60?(t=!0,o=this.next()):o===33?(n=!0,r="!!",o=this.next()):r="!";let s=this.position;if(t){do o=this.next();while(o!==0&&o!==62);if(this.position<this.length)i=this.input.slice(s,this.position),o=this.next();else throw this.#e("Cannot read tag property: unexpected end of stream")}else{for(;o!==0&&!y(o);){if(o===33){if(n)throw this.#e("Cannot read tag property: tag suffix cannot contain an exclamation mark");if(r=this.input.slice(s-1,this.position+1),!Ze.test(r))throw this.#e("Cannot read tag property: named tag handle contains invalid characters");n=!0,s=this.position+1}o=this.next()}if(i=this.input.slice(s,this.position),Zr.test(i))throw this.#e("Cannot read tag property: tag suffix cannot contain flow indicator characters")}if(i&&!et.test(i))throw this.#e(`Cannot read tag property: invalid characters in tag name "${i}"`);if(t)this.tag=i;else if(this.tagMap.has(r))this.tag=this.tagMap.get(r)+i;else if(r==="!")this.tag=`!${i}`;else if(r==="!!")this.tag=`tag:yaml.org,2002:${i}`;else throw this.#e(`Cannot read tag property: undeclared tag handle "${r}"`);return!0}readAnchorProperty(){let t=this.peek();if(t!==38)return!1;if(this.anchor!==null)throw this.#e("Cannot read anchor property: duplicate anchor property");t=this.next();let n=this.position;for(;t!==0&&!y(t)&&!E(t);)t=this.next();if(this.position===n)throw this.#e("Cannot read anchor property: name of an anchor node must contain at least one character");return this.anchor=this.input.slice(n,this.position),!0}readAlias(){if(this.peek()!==42)return!1;let t=this.next(),n=this.position;for(;t!==0&&!y(t)&&!E(t);)t=this.next();if(this.position===n)throw this.#e("Cannot read alias: alias name must contain at least one character");let r=this.input.slice(n,this.position);if(!this.anchorMap.has(r))throw this.#e(`Cannot read alias: unidentified alias "${r}"`);return this.result=this.anchorMap.get(r),this.skipSeparationSpace(!0,-1),!0}composeNode({parentIndent:t,nodeContext:n,allowToSeek:r,allowCompact:i}){let o=1,s=!1,c=!1,l;this.tag=null,this.anchor=null,this.kind=null,this.result=null;let f=X===n||Xe===n,p=f,h=f;if(r&&this.skipSeparationSpace(!0,-1)&&(s=!0,this.lineIndent>t?o=1:this.lineIndent===t?o=0:this.lineIndent<t&&(o=-1)),o===1)for(;this.readTagProperty()||this.readAnchorProperty();)this.skipSeparationSpace(!0,-1)?(s=!0,p=h,this.lineIndent>t?o=1:this.lineIndent===t?o=0:this.lineIndent<t&&(o=-1)):p=!1;if(p&&(p=s||i),o===1||X===n){let d=J===n||Je===n?t:t+1,m=this.position-this.lineStart;if(o===1)if(p&&(this.readBlockSequence(m)||this.readBlockMapping(m,d))||this.readFlowCollection(d))c=!0;else{if(f&&this.readBlockScalar(d)||this.readSingleQuotedScalar(d)||this.readDoubleQuotedScalar(d))c=!0;else if(this.readAlias()){if(c=!0,this.tag!==null||this.anchor!==null)throw this.#e("Cannot compose node: alias node should not have any properties")}else this.readPlainScalar(d,J===n)&&(c=!0,this.tag===null&&(this.tag="?"));this.anchor!==null&&this.anchorMap.set(this.anchor,this.result)}else o===0&&(c=p&&this.readBlockSequence(m))}if(this.tag!==null&&this.tag!=="!")if(this.tag==="?"){for(let u=0;u<this.implicitTypes.length;u++)if(l=this.implicitTypes[u],l.resolve(this.result)){this.result=l.construct(this.result),this.tag=l.tag,this.anchor!==null&&this.anchorMap.set(this.anchor,this.result);break}}else if(this.typeMap[this.kind??"fallback"].has(this.tag)){if(l=this.typeMap[this.kind??"fallback"].get(this.tag),this.result!==null&&l.kind!==this.kind)throw this.#e(`Unacceptable node kind for !<${this.tag}> tag: it should be "${l.kind}", not "${this.kind}"`);if(l.resolve(this.result))this.result=l.construct(this.result),this.anchor!==null&&this.anchorMap.set(this.anchor,this.result);else throw this.#e(`Cannot resolve a node with !<${this.tag}> explicit tag`)}else throw this.#e(`Cannot resolve unknown tag !<${this.tag}>`);return this.tag!==null||this.anchor!==null||c}readDocument(){let t=this.position,n=!1;this.version=null,this.checkLineBreaks=!1,this.tagMap=new Map,this.anchorMap=new Map;let r=this.peek();for(;r!==0&&(this.skipSeparationSpace(!0,-1),r=this.peek(),!(this.lineIndent>0||r!==37));){n=!0,r=this.next();let i=this.position;for(;r!==0&&!y(r);)r=this.next();let o=this.input.slice(i,this.position),s=[];if(o.length<1)throw this.#e("Cannot read document: directive name length must be greater than zero");for(;r!==0&&(this.skipWhitespaces(),this.skipComment(),r=this.peek(),!x(r));){for(i=this.position;r!==0&&!y(r);)r=this.next();s.push(this.input.slice(i,this.position))}switch(r!==0&&this.readLineBreak(),o){case"YAML":this.yamlDirectiveHandler(...s);break;case"TAG":this.tagDirectiveHandler(...s);break;default:this.dispatchWarning(`unknown document directive "${o}"`);break}r=this.peek()}if(this.skipSeparationSpace(!0,-1),this.lineIndent===0&&this.peek()===45&&this.peek(1)===45&&this.peek(2)===45)this.position+=3,this.skipSeparationSpace(!0,-1);else if(n)throw this.#e("Cannot read document: directives end mark is expected");if(this.composeNode({parentIndent:this.lineIndent-1,nodeContext:X,allowToSeek:!1,allowCompact:!0}),this.skipSeparationSpace(!0,-1),this.checkLineBreaks&&zr.test(this.input.slice(t,this.position))&&this.dispatchWarning("non-ASCII line breaks are interpreted as content"),this.position===this.lineStart&&this.testDocumentSeparator())this.peek()===46&&(this.position+=3,this.skipSeparationSpace(!0,-1));else if(this.position<this.length-1)throw this.#e("Cannot read document: end of the stream or a document separator is expected");return this.result}*readDocuments(){for(;this.position<this.length-1;)yield this.readDocument()}};function si(e){return e=String(e),e.length>0&&(x(e.charCodeAt(e.length-1))||(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1))),e+="\0",e}function be(e,t={}){e=si(e);let r=new ne(e,{...t,schema:j.get(t.schema)}).readDocuments(),i=r.next().value;if(!r.next().done)throw new SyntaxError("Found more than 1 document in the stream: expected a single document");return i??null}var ft=1,ht=2,dt=3,mt=4,Y=5,ai=/^\n* /,li=new Map([[0,"\\0"],[7,"\\a"],[8,"\\b"],[9,"\\t"],[10,"\\n"],[11,"\\v"],[12,"\\f"],[13,"\\r"],[27,"\\e"],[34,'\\"'],[92,"\\\\"],[133,"\\N"],[160,"\\_"],[8232,"\\L"],[8233,"\\P"]]),ci=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"];function ot(e){let t=e.toString(16).toUpperCase();if(e<=255)return`\\x${t.padStart(2,"0")}`;if(e<=65535)return`\\u${t.padStart(4,"0")}`;if(e<=4294967295)return`\\U${t.padStart(8,"0")}`;throw new Error("Code point within a string may not be greater than 0xFFFFFFFF")}function ui(e){let t=new Map;for(let n of Object.keys(e)){let r=String(e[n]);n.slice(0,2)==="!!"&&(n=`tag:yaml.org,2002:${n.slice(2)}`),t.set(n,r)}return t}function st(e,t){let n=" ".repeat(t);return e.split(`
`).map(r=>r.length?n+r:r).join(`
`)}function at(e,t){return`
${" ".repeat(e*t)}`}function re(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==65279||65536<=e&&e<=1114111}function we(e){return re(e)&&e!==65279&&e!==44&&e!==91&&e!==93&&e!==123&&e!==125&&e!==58&&e!==35}function pi(e){return we(e)&&!w(e)&&e!==45&&e!==63&&e!==38&&e!==42&&e!==33&&e!==124&&e!==62&&e!==39&&e!==34&&e!==37&&e!==64&&e!==96}function gt(e){return ai.test(e)}function fi(e,t,n,r,i,o){let s=r!==-1,c=!1,l=!1,f=-1,p=pi(e.charCodeAt(0))&&!w(e.charCodeAt(e.length-1)),h,u;if(t)for(u=0;u<e.length;u++){if(h=e.charCodeAt(u),!re(h))return Y;p=p&&we(h)}else{for(u=0;u<e.length;u++){if(h=e.charCodeAt(u),h===10)c=!0,s&&(l=l||u-f-1>r&&e[f+1]!==" ",f=u);else if(!re(h))return Y;p=p&&we(h)}l=l||s&&u-f-1>r&&e[f+1]!==" "}return!c&&!l?p&&!i.some(d=>d.resolve(e))?ft:o==="'"?ht:Y:n>9&&gt(e)?Y:l?mt:dt}function lt(e,t){if(e===""||e[0]===" ")return e;let n=/ [^ ]/g,r=0,i,o=0,s=0,c=[];for(let l of e.matchAll(n))s=l.index,s-r>t&&(i=o>r?o:s,c.push(e.slice(r,i)),r=i+1),o=s;return e.length-r>t&&o>r?(c.push(e.slice(r,o)),c.push(e.slice(o+1))):c.push(e.slice(r)),c.join(`
`)}function ct(e){return e.at(-1)===`
`?e.slice(0,-1):e}function hi(e,t){let n=/(\n+)([^\n]*)/g,r=(()=>{let c=e.indexOf(`
`);return c=c!==-1?c:e.length,n.lastIndex=c,lt(e.slice(0,c),t)})(),i=e[0]===`
`||e[0]===" ",o,s;for(;s=n.exec(e);){let c=s[1],l=s[2]||"";o=l[0]===" ",r+=c+(!i&&!o&&l!==""?`
`:"")+lt(l,t),i=o}return r}function di(e){let t="",n,r,i;for(let o=0;o<e.length;o++){if(n=e.charCodeAt(o),n>=55296&&n<=56319&&(r=e.charCodeAt(o+1),r>=56320&&r<=57343)){t+=ot((n-55296)*1024+r-56320+65536),o++;continue}i=li.get(n),t+=!i&&re(n)?e[o]:i||ot(n)}return t}function ut(e,t){let n=gt(e)?String(t):"",r=e[e.length-1]===`
`,o=r&&(e[e.length-2]===`
`||e===`
`)?"+":r?"":"-";return`${n}${o}
`}function yt(e,t,n){if(!D(e))return;if(t.has(e)){n.add(e);return}t.add(e);let r=Array.isArray(e)?e:Object.values(e);for(let i of r)yt(i,t,n)}var ie=class{indent;arrayIndent;skipInvalid;flowLevel;sortKeys;lineWidth;useAnchors;compatMode;condenseFlow;implicitTypes;explicitTypes;duplicates=[];usedDuplicates=new Set;styleMap=new Map;quoteStyle;constructor({schema:t=L,indent:n=2,arrayIndent:r=!0,skipInvalid:i=!1,flowLevel:o=-1,styles:s=void 0,sortKeys:c=!1,lineWidth:l=80,useAnchors:f=!0,compatMode:p=!0,condenseFlow:h=!1,quoteStyle:u="'"}){this.indent=Math.max(1,n),this.arrayIndent=r,this.skipInvalid=i,this.flowLevel=o,s&&(this.styleMap=ui(s)),this.sortKeys=c,this.lineWidth=l,this.useAnchors=f,this.compatMode=p,this.condenseFlow=h,this.implicitTypes=t.implicitTypes,this.explicitTypes=t.explicitTypes,this.quoteStyle=u}stringifyScalar(t,{level:n,isKey:r}){if(t.length===0)return"''";if(this.compatMode&&ci.includes(t))return`'${t}'`;let i=this.indent*Math.max(1,n),o=this.lineWidth===-1?-1:Math.max(Math.min(this.lineWidth,40),this.lineWidth-i),s=r||this.flowLevel>-1&&n>=this.flowLevel;switch(fi(t,s,this.indent,o,this.implicitTypes,this.quoteStyle)){case ft:return t;case ht:return`'${t.replace(/'/g,"''")}'`;case dt:return`|${ut(t,this.indent)}${ct(st(t,i))}`;case mt:return`>${ut(t,this.indent)}${ct(st(hi(t,o),i))}`;case Y:return`"${di(t)}"`;default:throw new TypeError("Invalid scalar style should be unreachable: please file a bug report against Deno at https://github.com/denoland/std/issues")}}stringifyFlowSequence(t,{level:n}){let r=[];for(let o of t){let s=this.stringifyNode(o,{level:n,block:!1,compact:!1,isKey:!1});s!==null&&r.push(s)}let i=this.condenseFlow?",":", ";return`[${r.join(i)}]`}stringifyBlockSequence(t,{level:n,compact:r}){let i=at(this.indent,n),o=r?"":i,s=[];for(let c of t){let l=this.stringifyNode(c,{level:n+1,block:!0,compact:!0,isKey:!1});if(l===null)continue;let f=10===l.charCodeAt(0)?"-":"- ";s.push(`${f}${l}`)}return s.length?o+s.join(i):"[]"}stringifyFlowMapping(t,{level:n}){let r=this.condenseFlow?'"':"",i=this.condenseFlow?":":": ",o=[];for(let[s,c]of Object.entries(t)){let l=this.stringifyNode(s,{level:n,block:!1,compact:!1,isKey:!1});if(l===null)continue;let f=this.stringifyNode(c,{level:n,block:!1,compact:!1,isKey:!1});if(f===null)continue;let p=l.length>1024?"? ":"";o.push(r+p+l+r+i+f)}return`{${o.join(", ")}}`}stringifyBlockMapping(t,{tag:n,level:r,compact:i}){let o=Object.keys(t);if(this.sortKeys===!0)o.sort();else if(typeof this.sortKeys=="function")o.sort(this.sortKeys);else if(this.sortKeys)throw new TypeError(`"sortKeys" must be a boolean or a function: received ${typeof this.sortKeys}`);let s=at(this.indent,r),c=[];for(let f of o){let p=t[f],h=this.stringifyNode(f,{level:r+1,block:!0,compact:!0,isKey:!0});if(h===null)continue;let u=n!==null&&n!=="?"||h.length>1024,d=this.stringifyNode(p,{level:r+1,block:!0,compact:u,isKey:!1});if(d===null)continue;let m="";u&&(m+=h.charCodeAt(0)===10?"?":"? "),m+=h,u&&(m+=s),m+=d.charCodeAt(0)===10?":":": ",m+=d,c.push(m)}let l=i?"":s;return c.length?l+c.join(s):"{}"}getTypeRepresentation(t,n){if(!t.represent)return n;let r=this.styleMap.get(t.tag)??t.defaultStyle;if(typeof t.represent=="function")return t.represent(n,r);let i=t.represent[r];if(!i)throw new TypeError(`!<${t.tag}> tag resolver accepts not "${r}" style`);return i(n,r)}detectType(t){for(let n of this.implicitTypes)if(n.predicate?.(t))return t=this.getTypeRepresentation(n,t),{tag:"?",value:t};for(let n of this.explicitTypes)if(n.predicate?.(t))return t=this.getTypeRepresentation(n,t),{tag:n.tag,value:t};return{tag:null,value:t}}stringifyNode(t,{level:n,block:r,compact:i,isKey:o}){let s=this.detectType(t),c=s.tag;if(t=s.value,r&&(r=this.flowLevel<0||this.flowLevel>n),typeof t=="string"||t instanceof String)t=t instanceof String?t.valueOf():t,c!=="?"&&(t=this.stringifyScalar(t,{level:n,isKey:o}));else if(D(t)){let l=this.duplicates.indexOf(t),f=l!==-1;if(f){if(this.usedDuplicates.has(t))return`*ref_${l}`;this.usedDuplicates.add(t)}if((c!==null&&c!=="?"||f||this.indent!==2&&n>0)&&(i=!1),Array.isArray(t)){let p=!this.arrayIndent&&n>0?n-1:n;r&&t.length!==0?(t=this.stringifyBlockSequence(t,{level:p,compact:i}),f&&(t=`&ref_${l}${t}`)):(t=this.stringifyFlowSequence(t,{level:p}),f&&(t=`&ref_${l} ${t}`))}else r&&Object.keys(t).length!==0?(t=this.stringifyBlockMapping(t,{tag:c,level:n,compact:i}),f&&(t=`&ref_${l}${t}`)):(t=this.stringifyFlowMapping(t,{level:n}),f&&(t=`&ref_${l} ${t}`))}else{if(this.skipInvalid)return null;throw new TypeError(`Cannot stringify ${typeof t}`)}return c!==null&&c!=="?"&&(t=`!<${c}> ${t}`),t}stringify(t){if(this.useAnchors){let r=new Set,i=new Set;yt(t,r,i),this.duplicates=[...i],this.usedDuplicates=new Set}let n=this.stringifyNode(t,{level:0,block:!0,compact:!0,isKey:!1});return n!==null?`${n}
`:""}};function xt(e,t={}){return new ie({...t,schema:j.get(t.schema)}).stringify(e)}var wt="spools.yaml",mi="jobs.yaml";async function St(e){let t=await oe(),n=`<div class='silverspooler spools'>
  <table>
  <thead>
    <tr>
      <td>Brand</td>
      <td>Material</td>
      <td>Color</td>
      <td style='text-align: right;'>Left</td>
      <td style='text-align: right;'>Original</td>
      <td style='text-align: right;'>Gross</td>
      <td></td>
    </tr>
  </thead>
  <tbody>`;return t.forEach(r=>{(!e||e&&!r.isRetired)&&(n+=`<tr class='${r.isRetired?"retired":"active"}'>
      <td>${r.brand}</td>
      <td>${r.material}</td>
      <td>${r.colorName}${r.isTranslucent?"/TL":""}</td>`,r.isRetired?n+="<td style='text-align: right;' class='remaining'>&mdash;</td><td style='text-align: right;'>&mdash;</td><td style='text-align: right;'>&mdash;</td><td></td>":(n+=`
        <td style='text-align: right;' class='left'">${r.remainingWeight}</td>
        <td style='text-align: right;' class="net">${r.initialNetWeight}</td>
        <td style='text-align: right;' class="gross">${r.grossWeight}</td>`,n+=`<td><button class='sb-button-primary spoolretire' data-item='retire|${r.id}'>Retire</button></td>`),n+="</tr>")}),n+=`</tbody>
  </table>
  </div>`,n}async function kt(){return`
  <button class='sb-button-primary' onclick='javascript:document.getElementById("new-spool").style["display"] = ""; this.style["display"] = "none";'>Add New Spool</button>
  <div id='new-spool' style='display: none;'>
  <input type='text' required id='spoolbrand' placeholder='Filament Brand' />
  <input type='text' required id='spoolmaterial' placeholder='Filament Material' />
  <input type='text' required id='spoolcolor' placeholder='Filament Color' />
  <input type='checkbox' id='spooltranslucent' /> <label>Translucent</label><br>
  <label>Net Weight</label> <input type='number' required id='spoolnetweight' />
  <label>Gross Weight</label> <input type='number' required id='spoolgrossweight' /><br>
  <button class="sb-button-primary" data-item="newspool" onclick='javascript:document.getElementById("newspooldata").value ="br="+encodeURIComponent(document.getElementById("spoolbrand").value)+"&mt="+encodeURIComponent(document.getElementById("spoolmaterial").value)+"&cl="+encodeURIComponent(document.getElementById("spoolcolor").value)+"&tl="+encodeURIComponent(document.getElementById("spooltranslucent").checked)+"&nw="+encodeURIComponent(document.getElementById("spoolnetweight").value)+"&gw="+encodeURIComponent(document.getElementById("spoolgrossweight").value);'>Save</button>
  <input type='hidden' id='newspooldata' value='test-data' />
  </div>
  `}async function Tt(){let e=await At(),t=`<div class='silverspooler printjobs'>
  <table>
  <thead>
    <tr>
      <td style='text-align: right;'>Date</td>
      <td>Description</td>
      <td colspan='3'>Spool</td>
      <td style='text-align: right;'>Weight</td>
      <td style='text-align: right;'>Duration</td>
      <td>Notes</td>
      <td></td>
    </tr>
  </thead>
  <tbody>`;return e.forEach(n=>{t+=`<tr>
    <td style='text-align: right;'>${new Date(n.date).toLocaleDateString()}</td>
    <td>${n.description}</td>
    <td>${n.spoolBrand}</td>
    <td>${n.spoolMaterial}</td>
    <td>${n.spoolColorName}</td>
    <td style='text-align: right;'>${n.filamentWeight}</td>
    <td style='text-align: right;'>${xi(n.duration)}</td>
    <td>${n.notes?n.notes:""}</td>
    <td>TODO</td>
    </tr>`}),t+=`</tbody>
  </table>
  </div>`,t}async function Pt(e,t){if(P(e))if(e.startsWith("retire|")){if(await b.confirm("Are you sure you want to retire that spool?")){let r=e.substring(7),i=await oe();for(let o of i)if(o.id==r){o.isRetired=!0,await bt(i),await Se("Spool retired.");break}}}else if(e=="newspool"){if(!P(t)){v("No valid arguments.");return}let n=t.split("&"),r="",i="",o="",s=!1,c=0,l=0;for(let h of n){let u=h.split("=");u[1]=decodeURIComponent(u[1]),u[0]=="br"?r=u[1]:u[0]=="mt"?i=u[1]:u[0]=="cl"?o=u[1]:u[0]=="tl"?(u[1]=u[1].toLowerCase(),s=u[1]==="true"||u[1]==="1"||u[1]==="on"):u[0]=="nw"?c=Number(u[1]):u[0]=="gw"&&(l=Number(u[1]))}if(!P(r)){b.flashNotification("Please specify spool Brand.");return}if(!P(i)){b.flashNotification("Please specify spool Material.");return}if(!P(o)){b.flashNotification("Please specify spool Color.");return}if(c<=0||c>1e4){b.flashNotification("Please specify a spool Net Weight between 1 and 10000.");return}if(l<=0||l>1e4){b.flashNotification("Please specify a spool Gross Weight between 1 and 10000.");return}if(l<=c){b.flashNotification("Please specify a spool Gross Weight larger than Net Weight.");return}let f={id:Si(),brand:r,material:i,colorName:o,isTranslucent:s,initialNetWeight:c,grossWeight:l,isRetired:!1,remainingWeight:c},p=await oe();p.push(f),await bt(p),await Se("New spool saved.")}else v("Invalid click data.")}async function Et(){H=null,k=null,T=null,await Se("SilverSpooler data refreshed.")}async function Se(e){await V.refreshAll(),await b.flashNotification(e)}var k;async function oe(){if(k==null){let e=await ke(wt);v("Loading spools from "+e);let t=Ct(await M.readDocument(e));P(t)?(k=await be(t).spools,await gi(k)):k=new Array,v("Loaded spools: "+k.length)}return k}async function bt(e){k=e;let t=new Array;for(let r of e)t.push({id:r.id,brand:r.brand,material:r.material,colorName:r.colorName,isTranslucent:r.isTranslucent,grossWeight:r.grossWeight,initialNetWeight:r.initialNetWeight,isRetired:r.isRetired});let n=await xt({spools:t});await M.writeDocument(await ke(wt),wi(n))}var T;async function At(){if(T==null){let e=await ke(mi);v("Loading jobs from "+e);let t=Ct(await M.readDocument(e));P(t)?(T=await be(t).jobs,await yi(T)):T=new Array,v("Loaded jobs: "+T.length)}return T}async function gi(e){let t=await At();e.forEach(n=>{(n.remainingWeight===void 0||n.remainingWeight===null)&&(n.remainingWeight=n.initialNetWeight),t.forEach(r=>{r.spoolId===n.id&&(n.remainingWeight-=r.filamentWeight)})})}async function yi(e){let t=await oe();e.forEach(n=>{n.spoolBrand="n/a",n.spoolMaterial="n/a",n.spoolColorName="n/a",t.forEach(r=>{r.id===n.spoolId&&(n.spoolBrand=r.brand,n.spoolMaterial=r.material,n.spoolColorName=r.colorName,n.spoolIsTranslucent=r.isTranslucent)})})}function xi(e){let t=Math.floor(e/60),n=e%60,r=n<10?`0${n}`:`${n}`;return t>0?`${t}h ${r}m`:`${r}m`}async function ke(e){return(await bi()).pathPrefix+e}var H;async function bi(){if(H==null){v("Reading settings");let e=await Q.getConfig("silverSpooler",{});P(e.pathPrefix)||(e.pathPrefix="Files/SilverSpooler/"),H=e}return H}function Ct(e,t="utf-8"){return new TextDecoder(t).decode(e)}function wi(e){return new TextEncoder().encode(e)}function P(e){return typeof e=="string"&&e.length>0}function Si(){return crypto.randomUUID().replace(/[{}()-]/g,"")}function v(e){console.log("SilverSpooler: "+e)}var vt={renderSpools:St,renderPrintJobs:Tt,click:Pt,renderNewSpool:kt,refresh:Et},Mt={name:"silverspooler",functions:{renderSpools:{path:"silverspooler.ts:renderSpools"},renderPrintJobs:{path:"silverspooler.ts:renderPrintJobs"},click:{path:"silverspooler.ts:click"},renderNewSpool:{path:"silverspooler.ts:renderNewSpool"},refresh:{path:"silverspooler.ts:refresh",command:{name:"SilverSpooler: Refresh"}}},assets:{}},ss={manifest:Mt,functionMapping:vt};Pe(vt,Mt,self.postMessage);export{ss as plug};
